/*! cubesviewer 20-04-2016 */
function cubesviewer(){this.version="1.2.1-devel",this.options={cubesUrl:null,cubesLang:null,pagingOptions:[15,30,100,250],datepickerShowWeek:!0,datepickerFirstDay:1,tableResizeHackMinWidth:350,jsonRequestType:"json"},this.cubesserver=null,this.alert=function(a){alert("CubesViewer "+this.version+"\n\n"+a)},this.refresh=function(){$(document).trigger("cubesviewerRefresh")},this.cubesAjaxHandler=function(a){return cubesviewer.cubesRequest(a.url,a.data||[],a.success)},this.getView=function(a){var b=a.toString();return b=0===b.indexOf("view")?b:"view"+b,b="#"===b[0]?b:"#"+b,$(b+" .cv-gui-viewcontent").data("cubesviewer-view")},this.cubesRequest=function(a,b,c){"/"==a.charAt(0)&&(a=this.options.cubesUrl+a);var d=$.get(a,b,this._cubesRequestCallback(c),cubesviewer.options.jsonRequestType);return d.fail(cubesviewer.defaultRequestErrorHandler),d},this._cubesRequestCallback=function(a){return function(b,c){a(b)}},this.defaultRequestErrorHandler=function(a,b,c){401==a.status?cubesviewer.alert("Unauthorized."):403==a.status?cubesviewer.alert("Forbidden."):400==a.status?cubesviewer.alert($.parseJSON(a.responseText).message):(console.debug(a),cubesviewer.showInfoMessage("CubesViewer: An error occurred while accessing the data server.\n\nPlease try again or contact the application administrator if the problem persists.\n"))},this.changeCubesLang=function(a){this.options.cubesLang=""==a?null:a,this.refresh()},this.init=function(a){$.extend(cubesviewer.options,a),$.ajaxSetup({traditional:!0}),cubesviewer.cubesserver=new cubes.Server(cubesviewer.cubesAjaxHandler),cubesviewer.cubesserver.connect(this.options.cubesUrl,function(){cubesviewer.showInfoMessage("Cubes client initialized (server version: "+cubesviewer.cubesserver.server_version+")"),$(document).trigger("cubesviewerInitialized",[this])})},this.showInfoMessage=function(a,b){void 0==b&&(b=5e3),$("#cv-cache-indicator").size()<1&&($("body").append('<div id="cv-cache-indicator" class="cv-view-panel yui3-cssreset" style="display: none;"></div>'),$("#cv-cache-indicator").qtip({content:"NO MESSAGE DEFINED",position:{my:"bottom right",at:"bottom right",target:$(window),adjust:{x:-10,y:-10}},style:{classes:"fixed",tip:{corner:!1}},show:{delay:0,event:""},hide:{inactive:b}})),$("#cv-cache-indicator").qtip("option","content.text",a),$("#cv-cache-indicator").qtip("toggle",!0)}}function cubesviewerViews(){this.STATE_INITIALIZING=1,this.STATE_INITIALIZED=2,this.STATE_ERROR=3,this.cubesviewer=cubesviewer,this.showFatal=function(a,b){a.empty().append('<div class="ui-widget"><div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><strong>Error</strong><br/><br/>'+b+"</p></div></div>")},this.createView=function(a,b,c,d){var e={};if("string"==typeof d)try{e=$.parseJSON(d)}catch(f){this.cubesviewer.alert("Error: could not process serialized data (JSON parse error)."),e.name="Undefined view"}else e=d;var g={id:a,cubesviewer:this.cubesviewer,type:c,container:b,state:cubesviewer.views.STATE_INITIALIZING,params:{}};return $.extend(g.params,e),$(document).trigger("cubesviewerViewCreate",[g]),$.extend(g.params,e),g.state==cubesviewer.views.STATE_INITIALIZING&&(g.state=cubesviewer.views.STATE_INITIALIZED),$(b).data("cubesviewer-view",g),g},this.destroyView=function(a){$(document).trigger("cubesviewerViewDestroyed",[a])},this.getParentView=function(a){var b=null;return $(a).parents().each(function(a,c){void 0!=$(c).data("cubesviewer-view")&&null==b&&(b=$(c).data("cubesviewer-view"))}),b},this.blockView=function(a,b){"undef"==b&&(b=null),$(a.container).block({message:b,fadeOut:200,onUnblock:function(){$(a.container).css("position","inherit")}})},this.blockViewLoading=function(a){this.blockView(a,'<span class="ajaxloader" title="Loading..." >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loading</span>')},this.unblockView=function(a){$(a.container).unblock()},this.redrawView=function(a){$(document).trigger("cubesviewerViewDraw",[a])},this.onViewDraw=function(a,b){return b.state==cubesviewer.views.STATE_ERROR?(cubesviewer.views.showFatal(b.container,"An error has occurred. Cannot present view."),void a.stopImmediatePropagation()):void 0},this.serialize=function(a){return JSON.stringify(a.params)}}function cubesviewerViewCube(){this.cubesviewer=cubesviewer,this.onViewCreate=function(a,b){$.extend(b.params,{mode:"explore",drilldown:[],cuts:[]}),b.cube=null;var c=cubesviewer.cubesserver.get_cube(b.params.cubename,function(a){b.cube=a,"cv-view-params"in a.info&&$.extend(b.params,a.info["cv-view-params"]),b.state==cubesviewer.views.STATE_INITIALIZED&&cubesviewer.views.redrawView(b)});c&&c.fail(function(){b.state=cubesviewer.views.STATE_ERROR,cubesviewer.views.redrawView(b)})},this.drawMenu=function(a){$(a.container).find(".cv-view-toolbar").append('<button class="viewbutton" title="View" style="margin-right: 5px;">View</button>'),$(a.container).find(".cv-view-viewmenu").append('<ul class="cv-view-menu cv-view-menu-view" style="float: right; width: 180px;"></ul>'),$(a.container).find(".viewbutton").button(),a.cubesviewer.views.cube._initMenu(a,".viewbutton",".cv-view-menu-view")},this.onViewDraw=function(a,b){return null==b.cube?($(b.container).append("Loading..."),void a.stopImmediatePropagation()):(0==$(".cv-view-viewdata",b.container).size()&&($(b.container).empty(),$(b.container).append('<div class="cv-view-panel"><div class="cv-view-viewmenu"></div><div class="cv-view-viewinfo"></div><div class="cv-view-viewdata" style="clear: both;"></div><div class="cv-view-viewfooter" style="clear: both;"></div></div>')),$(b.container).find(".cv-view-viewmenu").empty().append('<div style="float: right; z-index: 9990; margin-bottom: 5px;"><div class="cv-view-toolbar ui-widget-header ui-corner-all" style="display: inline-block; padding: 2px;"></div></div>'),void b.cubesviewer.views.cube.drawMenu(b))},this._initMenu=function(a,b,c){$(".cv-view-toolbar",$(a.container)).find(b).on("click mouseenter",function(b){if("mouseenter"!=b.type||$(".cv-view-menu",a.container).is(":visible")){if("click"==b.type&&$(".cv-view-menu",a.container).is(":visible"))return void $(".cv-view-menu",a.container).hide();$(".cv-view-menu").hide();var d=$(c,$(a.container));return d.css("position","absolute"),d.css("z-index","9990"),d.show(),d.fadeIn().position({my:"right top",at:"right bottom",of:this}),$(document).one("click",cubesviewer.views.cube._hideMenu(d)),!1}}),$(c,$(a.container)).menu({}).hide()},this._hideMenu=function(a){return function(b){0==$(a).find(b.target).size()?a.fadeOut():$(document).one("click",cubesviewer.views.cube._hideMenu(a))}},this._adjustGridSize=function(){$(".cv-view-panel").each(function(a,b){$(".ui-jqgrid-btable",b).each(function(a,c){$(c).setGridWidth(cubesviewer.options.tableResizeHackMinWidth);var d=$(b).innerWidth()-20;d<cubesviewer.options.tableResizeHackMinWidth&&(d=cubesviewer.options.tableResizeHackMinWidth),$(c).setGridWidth(d)})})},this.buildBrowserArgs=function(a,b,c){var d={};if(!c){var e=a.params.drilldown.slice(0);b&&e.splice(0,0,a.params.xaxis);for(var f=0;f<e.length;f++)e[f]=cubes.drilldown_from_string(a.cube,a.cube.cvdim_parts(e[f]).fullDrilldownValue);e.length>0&&(d.drilldown=cubes.drilldowns_to_string(e))}var g=cubesviewer.views.cube.buildQueryCuts(a);return g.length>0&&(d.cut=new cubes.Cell(a.cube,g)),d},this.buildQueryCuts=function(a){var b=[];return $(a.params.cuts).each(function(c,d){var e=d.invert?"!":"";b.push(cubes.cut_from_string(a.cube,e+d.dimension+":"+d.value))}),b},this.columnFormatFunction=function(view,agmes){var measure=agmes;"measure"in agmes&&(measure=$.grep(view.cube.measures,function(a,b){return a.ref==agmes.measure})[0]);var formatterFunction=null;return formatterFunction=measure&&"cv-formatter"in measure.info?function(value){return eval(measure.info["cv-formatter"])}:function(a){return Math.formatnumber(a,"record_count"==agmes.ref?0:2)}}}function cubesviewerViewCubeExplore(){this.cubesviewer=cubesviewer,this.onViewDraw=function(a,b){null!=b.cube&&($(b.container).find(".cv-view-toolbar").prepend('<button class="explorebutton" title="Explore" style="margin-right: 10px;"><span class="ui-icon ui-icon-circle-arrow-s"></span></button>'),$(b.container).find(".viewbutton").before('<button class="drilldownbutton" title="Drilldown" style="margin-right: 5px;"><span class="ui-icon ui-icon-arrowthick-1-s"></span> Drilldown</button><button class="cutbutton" title="Filter" style="margin-right: 15px;"><span class="ui-icon ui-icon-zoomin"></span> Filter</button>'),$(b.container).find(".cv-view-viewmenu").append('<ul class="cv-view-menu cv-view-menu-drilldown" style="float: right; width: 180px;"></ul>'),$(b.container).find(".cv-view-viewmenu").append('<ul class="cv-view-menu cv-view-menu-cut" style="float: right; width: 180px;"></ul>'),$(b.container).find(".drilldownbutton").button(),$(b.container).find(".cutbutton").button(),$(b.container).find(".explorebutton").button(),$(b.container).find(".explorebutton").click(function(){return b.cubesviewer.views.cube.explore.modeExplore(b),!1}),$(b.container).find(".explorebutton").mouseenter(function(){$(".cv-view-menu").hide()}),b.cubesviewer.views.cube.explore.drawExploreMenu(b),b.cubesviewer.views.cube.explore.drawInfo(b),"explore"==b.params.mode&&($(b.container).find(".explorebutton").button("option","disabled","true").addClass("ui-state-active"),0==$(b.container).find(".cv-view-viewdata").children().size()&&$(b.container).find(".cv-view-viewdata").append("<h3>Aggregated Data</h3>"),b.cubesviewer.views.cube.explore.loadData(b)))},this.getDrillElementsList=function(a,b,c){var d=($(".cv-view-menu-drilldown",$(a.container)),a.cube),e="";return $(d.dimensions).each(function(d,f){if(1==f.levels.length){var g="";c&&$.grep(a.params.drilldown,function(a){return a==f.name}).length>0&&(g="ui-state-disabled"),e=e+'<li><a href="#" class="'+b+" "+g+'" data-dimension="'+f.name+'" data-value="1">'+f.label+"</a></li>"}else{if(e=e+'<li><a href="#" onclick="return false;">'+f.label+'</a><ul class="drillList" style="width: 170px; z-index: 9999;">',f.hierarchies_count()>1)for(var h in f.hierarchies){var i=f.hierarchies[h];e=e+'<li><a href="#" onclick="return false;">'+i.label+'</a><ul class="drillList" style="width: 160px; z-index: 9999;">',$(i.levels).each(function(a,c){e=e+'<li><a href="#" class="'+b+'" data-dimension="'+f.name+"@"+i.name+":"+c.name+'" data-value="1">'+c.label+"</a></li>"}),e+="</ul></li>"}else $(f.default_hierarchy().levels).each(function(a,c){e=e+'<li><a href="#" class="'+b+'" data-dimension="'+f.name+":"+c.name+'" data-value="1">'+c.label+"</a></li>"});e+="</ul></li>"}}),e},this.drawExploreMenuDrilldown=function(a){var b=$(".cv-view-menu-drilldown",$(a.container)),c=(a.cube,this.getDrillElementsList(a,"selectDrill",!0));b.append(""+c+'<div></div><li><a href="#" class="selectDrill" data-dimension=""><span class="ui-icon ui-icon-arrowthick-1-n" ></span><i>None</i></a></li>'),a.cubesviewer.views.cube._initMenu(a,".drilldownbutton",".cv-view-menu-drilldown")},this.drawExploreMenuFilter=function(a){var b=$(".cv-view-menu-cut",$(a.container));a.cube;"explore"==a.params.mode&&b.append('<li><a href="#" class="explore-filterselected" ><span class="ui-icon ui-icon-zoomin"></span>Filter selected</a></li><div></div>'),b.append('<div class="ui-explore-cut-clearsep"></div><li><a href="#" class="selectCut" data-dimension="" data-value="" ><span class="ui-icon ui-icon-close"></span>Clear filters</a></li>'),a.cubesviewer.views.cube._initMenu(a,".cutbutton",".cv-view-menu-cut")},this.drawExploreMenu=function(a){var b=$(".cv-view-menu-view",$(a.container));a.cube;this.drawExploreMenuDrilldown(a),this.drawExploreMenuFilter(a),$(b).menu("refresh"),$(b).addClass("ui-menu-icons"),$(a.container).find(".selectDrill").click(function(){return cubesviewer.views.cube.explore.selectDrill(a,$(this).attr("data-dimension"),$(this).attr("data-value")),!1}),$(a.container).find(".explore-filterselected").click(function(){return cubesviewer.views.cube.explore.filterSelected(a),!1}),$(a.container).find(".selectCut").click(function(){return cubesviewer.views.cube.explore.selectCut(a,$(this).attr("data-dimension"),$(this).attr("data-value"),$(this).attr("data-invert")),!1})},this.modeExplore=function(a){a.params.mode="explore",a.cubesviewer.views.redrawView(a)},this.loadData=function(a){a.cubesviewer.views.blockViewLoading(a);var b=this.cubesviewer.views.cube.buildBrowserArgs(a,!1,!1),c=new cubes.Browser(a.cubesviewer.cubesserver,a.cube),d=c.aggregate(b,a.cubesviewer.views.cube.explore._loadDataCallback(a));d.always(function(){a.cubesviewer.views.unblockView(a)})},this._loadDataCallback=function(a){var a=a;return function(b,c){$(a.container).find(".cv-view-viewdata").empty(),a.cubesviewer.views.cube.explore.drawSummary(a,b)}},this._sortData=function(a,b,c){},this._drilldownSortFunction=function(a,b){var c=a.params.drilldown.slice(0);return b&&c.splice(0,0,a.params.xaxis),function(b,d){for(var e=0;e<c.length;e++){var f=a.cube.cvdim_dim(c[e]);if(1==f.is_flat){if(b[f.name]<d[f.name])return-1;if(b[f.name]>d[f.name])return 1}else for(var g=0;g<f.levels.length;g++){var h=f.name+"."+f.levels[g].name;if(!(h in b&&h in d))break;if(b[h]<d[h])return-1;if(b[h]>d[h])return 1}}return 0}},this._addRows=function(a,b,c){if($(c.cells).each(function(c,d){for(var e=[],f=[],g=[],h=0;h<a.params.drilldown.length;h++){var i=(a.cube.cvdim_dim(a.params.drilldown[h]),a.cube.cvdim_parts(a.params.drilldown[h])),j=i.hierarchy.readCell(d,i.level),k=[],l=[];$(j).each(function(a,b){k.push(b.key),l.push(b.label)}),e.push(k.join("-"));var m=i.dimension.name+("default"!=i.hierarchy.name?"@"+i.hierarchy.name:"");g.push('<a href="#" class="cv-grid-link" onclick="cubesviewer.views.cube.explore.selectCut(cubesviewer.views.getParentView(this), $(this).attr(\'data-dimension\'), $(this).attr(\'data-value\'), $(this).attr(\'data-invert\')); return false;" class="selectCut" data-dimension="'+m+'" data-value="'+k.join(",")+'">'+l.join(" / ")+"</a>")}f.key=g.join(" / ");for(var h=0;h<g.length;h++)f["key"+h]=g[h];$(a.cube.aggregates).each(function(a,b){f[b.ref]=d[b.ref]}),f.id=e.join("-"),b.push(f)}),0==b.length&&c.summary){var d=[];d.key0="Summary",$(a.cube.aggregates).each(function(a,b){d[b.ref]=c.summary[b.ref]}),b.push(d)}},this.columnTooltipAttr=function(a){return function(b,c,d){return'title="'+a+" = "+c+'"'}},this.drawSummary=function(a,b){var c=a.cubesviewer;$(a.container).find(".cv-view-viewdata").empty(),$(a.container).find(".cv-view-viewdata").append('<h3>Aggregated Data</h3><table id="summaryTable-'+a.id+'"></table><div id="summaryPager-'+a.id+'"></div>');var d=[],e=[],f=[],g=[];$(a.cube.aggregates).each(function(f,h){d.push(h.label);var i=c.views.cube.columnFormatFunction(a,h),j={name:h.ref,index:h.ref,align:"right",sorttype:"number",width:c.views.cube.explore.defineColumnWidth(a,h.ref,95),formatter:function(a,b,c){return i(a)},cellattr:c.views.cube.explore.columnTooltipAttr(h.ref)};e.push(j),b.summary&&(g[h.ref]=b.summary[h.ref])}),c.views.cube.explore._sortData(a,b.cells,!1),c.views.cube.explore._addRows(a,f,b);var h=[];$(a.params.drilldown).each(function(b,c){h.push(a.cube.cvdim_dim(c).label)});for(var i=0;i<a.params.drilldown.length;i++)d.splice(i,0,h[i]),e.splice(i,0,{name:"key"+i,index:"key"+i,align:"left",width:c.views.cube.explore.defineColumnWidth(a,"key"+i,130)});0==a.params.drilldown.length&&(d.splice(0,0,""),e.splice(0,0,{name:"key0",index:"key0",align:"left",width:c.views.cube.explore.defineColumnWidth(a,"key0",110)})),g.key0=0==c.views.cube.buildQueryCuts(a).length?"<b>Summary</b>":"<b>Summary <i>(Filtered)</i></b>",$("#summaryTable-"+a.id).get(0).updateIdsOfSelectedRows=function(b,c){var d=$.inArray(b,$("#summaryTable-"+a.id).get(0).idsOfSelectedRows);!c&&d>=0?$("#summaryTable-"+a.id).get(0).idsOfSelectedRows.splice(d,1):0>d&&$("#summaryTable-"+a.id).get(0).idsOfSelectedRows.push(b)},$("#summaryTable-"+a.id).get(0).idsOfSelectedRows=[],$("#summaryTable-"+a.id).jqGrid({data:f,userData:b.summary?g:null,datatype:"local",height:"auto",rowNum:c.options.pagingOptions[0],rowList:c.options.pagingOptions,colNames:d,colModel:e,pager:"#summaryPager-"+a.id,sortname:c.views.cube.explore.defineColumnSort(a,["key","desc"])[0],viewrecords:!0,sortorder:c.views.cube.explore.defineColumnSort(a,["key","desc"])[1],footerrow:!0,userDataOnFooter:!0,forceFit:!1,shrinkToFit:!1,width:c.options.tableResizeHackMinWidth,multiselect:!0,multiboxonly:!0,onSelectRow:$("#summaryTable-"+a.id).get(0).updateIdsOfSelectedRows,onSelectAll:function(b,c){var d,e,f;for(d=0,e=b.length;e>d;d++)f=b[d],$("#summaryTable-"+a.id).get(0).updateIdsOfSelectedRows(f,c)},loadComplete:function(){var b,c;for(b=0,c=$("#summaryTable-"+a.id).get(0).idsOfSelectedRows.length;c>b;b++)$(this).jqGrid("setSelection",$("#summaryTable-"+a.id).get(0).idsOfSelectedRows[b],!1);a.cubesviewer.views.cube.explore.onTableLoaded(a)},resizeStop:a.cubesviewer.views.cube.explore._onTableResize(a),onSortCol:a.cubesviewer.views.cube.explore._onTableSort(a)}),this.cubesviewer.views.cube._adjustGridSize()},this._onTableSort=function(a){return function(b,c,d){a.cubesviewer.views.cube.explore.onTableSort(a,b,c,d)}},this._onTableResize=function(a){return function(b,c){a.cubesviewer.views.cube.explore.onTableResize(a,b,c)}},this.onTableResize=function(a,b,c){},this.onTableLoaded=function(a){},this.onTableSort=function(a,b,c,d,e){},this.defineColumnWidth=function(a,b,c){return c},this.defineColumnSort=function(a,b){return b},this.drawInfoPiece=function(a,b,c,d,e){var f="";return null!=c&&(f="max-width: "+c+"px;"),a.append('<div class="infopiece" style="background-color: '+b+'; white-space: nowrap;"><div style="white-space: nowrap; overflow: hidden; display: inline-block; vertical-align: middle; '+f+'">'+e+"</div>"+(d?"":' <button style="display: inline-block; vertical-align: middle;" class="cv-view-infopiece-close"><span class="ui-icon ui-icon-close"></span></button></div>')),a.children().last().addClass("ui-widget").css("margin","2px").css("padding","3px").css("display","inline-block").addClass("ui-corner-all"),a.children().last().find("button").button().find("span").css("padding","0px"),a.children().last()},this.drawInfo=function(a,b){$(a.container).find(".cv-view-viewinfo").empty(),$(a.container).find(".cv-view-viewinfo").append('<div><div class="cv-view-viewinfo-drill"></div><div class="cv-view-viewinfo-cut"></div><div class="cv-view-viewinfo-extra"></div></div>');a.cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-drill"),"#000000",200,!0,'<span class="ui-icon ui-icon-info"></span> <span style="color: white;" class="cv-view-viewinfo-cubename"><b>Cube:</b> '+a.cube.label+"</span>");$(a.params.drilldown).each(function(c,d){var e=a.cube.cvdim_parts(d),f=cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-drill"),"#ccffcc",360,b,'<span class="ui-icon ui-icon-arrowthick-1-s"></span> <b>Drilldown:</b> '+e.label);f.addClass("cv-view-infopiece-drilldown"),f.attr("data-dimension",d),f.find(".cv-view-infopiece-close").click(function(){a.cubesviewer.views.cube.explore.selectDrill(a,d,"")})}),$(a.params.cuts).each(function(c,d){var e=a.cube.cvdim_parts(d.dimension.replace(":","@")),f=d.invert?" != ":" = ",g=cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-cut"),"#ffcccc",480,b,'<span class="ui-icon ui-icon-zoomin"></span> <span><b>Filter: </b> '+e.label+f+'</span><span title="'+d.value+'">'+d.value+"</span>");g.addClass("cv-view-infopiece-cut"),g.attr("data-dimension",d.dimension),g.attr("data-value",d.value),g.attr("data-invert",d.invert||!1),g.find(".cv-view-infopiece-close").click(function(){a.cubesviewer.views.cube.explore.selectCut(a,d.dimension,"",d.invert)})}),b&&$(a.container).find(".infopiece").find(".ui-icon-close").parent().remove()},this.filterSelected=function(a){if(1!=a.params.drilldown.length)return void a.cubesviewer.alert("Can only filter multiple values in a view with one level of drilldown.");if($("#summaryTable-"+a.id).get(0).idsOfSelectedRows.length<=0)return void a.cubesviewer.alert("Cannot filter. No rows are selected.");var b=null,c=[],d=$("#summaryTable-"+a.id).get(0).idsOfSelectedRows,e=$.grep($("#summaryTable-"+a.id).jqGrid("getGridParam","data"),function(a){return-1!=$.inArray(a.id,d)});$(e).each(function(a,d){b=$(d.key0),c.push($(b).attr("data-value"))});var f=!1;this.selectCut(a,$(b).attr("data-dimension"),c.join(";"),f)},this.selectCut=function(a,b,c,d){""!=b?""!=c?(a.params.cuts=$.grep(a.params.cuts,function(a){return a.dimension==b},!0),a.params.cuts.push({dimension:b,value:c,invert:d})):a.params.cuts=$.grep(a.params.cuts,function(a){return a.dimension==b},!0):a.params.cuts=[],a.cubesviewer.views.redrawView(a)},this.selectDrill=function(a,b,c){a.cube;""==b?a.params.drilldown=[]:(cubesviewer.views.cube.explore.removeDrill(a,b),"1"==c&&a.params.drilldown.push(b)),a.cubesviewer.views.redrawView(a)},this.removeDrill=function(a,b){for(var c=b.split(":")[0],d=0;d<a.params.drilldown.length;d++)if(a.params.drilldown[d].split(":")[0]==c){a.params.drilldown.splice(d,1);break}}}function cubesviewerViewCubeDateFilter(){this.cubesviewer=cubesviewer,this._overridedbuildQueryCuts=null,this.onViewCreate=function(a,b){$.extend(b.params,{datefilters:[]})},this.onViewDraw=function(a,b){if(null!=b.cube){b.cube;b.cubesviewer.views.cube.datefilter.drawFilterMenu(b),b.cubesviewer.views.cube.datefilter.drawInfo(b)}},this.drawFilterMenu=function(a){var b=a.cube,c=$(".cv-view-menu-cut",$(a.container)),d="";$(b.dimensions).each(function(a,b){if(b.isDateDimension()){var c="";d=d+'<li><a href="#" class="selectDateFilter '+c+'" data-dimension="'+b.name+(b.info["cv-datefilter-hierarchy"]?"@"+b.info["cv-datefilter-hierarchy"]:"")+'" data-value="1">'+b.label+(b.hierarchy(b.info["cv-datefilter-hierarchy"])?" / "+b.hierarchy(b.info["cv-datefilter-hierarchy"]).label:"")+"</a></li>"}}),""==d&&(d+='<li><a href="#" onclick="return false;"><i>No date filters defined</i></a></li>'),$(".ui-explore-cut-clearsep",c).before('<li><a href="#" onclick="return false;"><span class="ui-icon ui-icon-zoomin"></span>Date filter</a><ul class="dateFilterList" style="width: 180px;">'+d+"</ul></li>"),$(c).menu("refresh"),$(c).addClass("ui-menu-icons"),$(a.container).find(".selectDateFilter").click(function(){return cubesviewer.views.cube.datefilter.selectDateFilter(a,$(this).attr("data-dimension"),$(this).attr("data-value")),!1})},this.drawInfo=function(a,b){$(a.container).find(".cv-view-viewinfo-cut").after('<div class="cv-view-viewinfo-date"></div>'),$(a.params.datefilters).each(function(c,d){var e=a.cube.cvdim_parts(d.dimension),f=cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-date"),"#ffdddd",null,b,'<span class="ui-icon ui-icon-zoomin"></span> <b>Filter: </b> '+e.labelNoLevel+': <span class="datefilter"></span>'),g=$(".datefilter",f);a.cubesviewer.views.cube.datefilter.drawDateFilter(a,d,g),f.find(".cv-view-infopiece-close").click(function(){a.cubesviewer.views.cube.datefilter.selectDateFilter(a,d.dimension,"0")})}),b&&$(a.container).find(".infopiece").find(".ui-icon-close").parent().remove()},this.drawDateFilter=function(a,b,c){$(c).append(' <select name="date_mode" ><option value="custom">Custom</option><optgroup label="Auto"><option value="auto-last1m">Last month</option><option value="auto-last3m">Last 3 months</option><option value="auto-last6m">Last 6 months</option><option value="auto-last12m">Last year</option><option value="auto-last24m">Last 2 years</option><option value="auto-january1st">From January 1st</option><option value="auto-yesterday">Yesterday</option></optgroup></select> Range: <input name="date_start" /> - <input name="date_end" /> '),$("[name='date_start']",c).datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showWeek:cubesviewer.options.datepickerShowWeek,firstDay:cubesviewer.options.datepickerFirstDay}),$("[name='date_end']",c).datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showWeek:cubesviewer.options.datepickerShowWeek,firstDay:cubesviewer.options.datepickerFirstDay}),$("[name='date_start']",c).attr("autocomplete","off"),$("[name='date_end']",c).attr("autocomplete","off"),$("input,select",c).change(function(){b.mode=$("[name='date_mode']",c).val(),b.date_from=$("[name='date_start']",c).val(),b.date_to=$("[name='date_end']",c).val(),a.cubesviewer.views.redrawView(a)}),$("[name='date_mode']",c).val(b.mode),$("[name='date_start']",c).val(b.date_from),$("[name='date_end']",c).val(b.date_to),"custom"!=$("[name='date_mode']",c).val()&&($("[name='date_start']",c).attr("disabled","disabled"),$("[name='date_end']",c).attr("disabled","disabled"))},this.selectDateFilter=function(a,b,c){a.cube;if(""!=b){if("1"==c)a.params.datefilters.push({dimension:b,mode:"auto-last3m",date_from:null,date_to:null});else for(var d=0;d<a.params.datefilters.length;d++)if(a.params.datefilters[d].dimension.split(":")[0]==b){a.params.datefilters.splice(d,1);break}}else a.params.datefilters=[];a.cubesviewer.views.redrawView(a)},this.datefilterValue=function(a,b){var c=null,d=null;if(0==b.mode.indexOf("auto-")?"auto-last1m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-1)):"auto-last3m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-3)):"auto-last6m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-6)):"auto-last12m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-12)):"auto-last24m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-24)):"auto-january1st"==b.mode?(c=new Date,c.setMonth(0),c.setDate(1)):"auto-yesterday"==b.mode&&(c=new Date,c.setDate(c.getDate()-1),d=new Date,d.setDate(c.getDate()-1)):"custom"==b.mode&&(null!=b.date_from&&""!=b.date_from&&(c=new Date(b.date_from)),null!=b.date_to&&""!=b.date_to&&(d=new Date(b.date_to))),null!=c||null!=d){var e="";return null!=c&&(e+=this._datefiltercell(a,b,c)),e+="-",null!=d&&(e+=this._datefiltercell(a,b,d)),e}return null},this._datefiltercell=function(a,b,c){for(var d=[],e=a.cube.cvdim_parts(b.dimension),f=0;f<e.hierarchy.levels.length;f++){var g=e.hierarchy.levels[f],h=g.role;"year"==h?d.push(c.getFullYear()):"month"==h?d.push(c.getMonth()+1):"quarter"==h?d.push(Math.floor(c.getMonth()/3)+1):"week"==h?d.push(this._weekNumber(c)):"day"==h?d.push(c.getDate()):cubesviewer.alert("Wrong configuration of model: time role of level '"+g.name+"' is invalid.")}return d.join(",")},this._weekNumber=function(a){a=new Date(a),a.setHours(0,0,0);var b=new Date(a.getFullYear(),0,1),c=Math.ceil(((a-b)/864e5+1)/7);return c},this.buildQueryCuts=function(a){var b=cubesviewer.views.cube.datefilter._overridedbuildQueryCuts(a);return $(a.params.datefilters).each(function(c,d){var e=a.cubesviewer.views.cube.datefilter.datefilterValue(a,d);null!=e&&b.push(cubes.cut_from_string(a.cube,d.dimension+":"+e))}),b}}function cubesviewerViewCubeRangeFilter(){this.cubesviewer=cubesviewer,this._overridedbuildQueryCuts=null,this.onViewCreate=function(a,b){$.extend(b.params,{rangefilters:[]})},this.onViewDraw=function(a,b){if(null!=b.cube){b.cube;b.cubesviewer.views.cube.rangefilter.drawFilterMenu(b),b.cubesviewer.views.cube.rangefilter.drawInfo(b)}},this.drawFilterMenu=function(a){var b=a.cube,c=$(".cv-view-menu-cut",$(a.container)),d="";$(b.dimensions).each(function(a,b){if(b.isRangeDimension()){var c="";d=d+'<li><a href="#" class="selectRangeFilter '+c+'" data-dimension="'+b.name+'" data-value="1">'+b.label+"</a></li>"}}),""==d&&(d+='<li><a href="#" onclick="return false;"><i>No range filters defined</i></a></li>'),$(".ui-explore-cut-clearsep",c).before('<li><a href="#" onclick="return false;"><span class="ui-icon ui-icon-zoomin"></span>Range filter</a><ul class="rangeFilterList" style="width: 180px;">'+d+"</ul></li>"),$(c).menu("refresh"),$(c).addClass("ui-menu-icons"),$(a.container).find(".selectRangeFilter").click(function(){return cubesviewer.views.cube.rangefilter.selectRangeFilter(a,$(this).attr("data-dimension"),$(this).attr("data-value")),!1})},this.drawInfo=function(a,b){$(a.container).find(".cv-view-viewinfo-cut").after('<div class="cv-view-viewinfo-range"></div>'),$(a.params.rangefilters).each(function(c,d){var e=a.cube.cvdim_parts(d.dimension),f=cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-range"),"#ffe8dd",null,b,'<span class="ui-icon ui-icon-zoomin"></span> <span><b>Filter: </b> '+e.labelNoLevel+': </span><span class="rangefilter"></span>'),g=$(".rangefilter",f);a.cubesviewer.views.cube.rangefilter.drawRangeFilter(a,d,g),f.find(".cv-view-infopiece-close").click(function(){a.cubesviewer.views.cube.rangefilter.selectRangeFilter(a,d.dimension,"0")})}),b&&$(a.container).find(".infopiece").find(".ui-icon-close").parent().remove()},this.drawRangeFilter=function(a,b,c){var d=a.cube.cvdim_parts(b.dimension);$(c).append('<input name="range_start" /> - <input name="range_end" /> ');var e=d.dimension.info["cv-rangefilter-slider"];null!=e&&$(c).append('<div style="display: inline-block; margin-left: 8px; margin-right: 8px; vertical-align: middle;"><span style="font-size: 70%;">'+e.min+'</span><span class="slider-range" style="width: 180px; display: inline-block; margin-left: 6px; margin-right: 6px; vertical-align: middle;"></span><span style="font-size: 70%;">'+e.max+"</span></div>"),$("input",c).change(function(){a.cubesviewer.views.cube.rangefilter._updateRangeFilter(a,b)}),$("[name='range_start']",c).val(b.range_from),$("[name='range_end']",c).val(b.range_to),e&&$(".slider-range",c).slider({range:!0,min:e.min,max:e.max,step:e.step?e.step:1,values:[b.range_from?b.range_from:e.min,b.range_to?b.range_to:e.max],slide:function(a,b){$("[name='range_start']",c).val(b.values[0]),$("[name='range_end']",c).val(b.values[1])},stop:function(c,d){a.cubesviewer.views.cube.rangefilter._updateRangeFilter(a,b)}})},this._updateRangeFilter=function(a,b){var c=!1,d=a.container;b.range_from!=$("[name='range_start']",d).val()&&(b.range_from=$("[name='range_start']",d).val(),c=!0),b.range_to!=$("[name='range_end']",d).val()&&(b.range_to=$("[name='range_end']",d).val(),c=!0),c&&a.cubesviewer.views.redrawView(a)},this.selectRangeFilter=function(a,b,c){a.cube;if(""!=b){if("1"==c)a.params.rangefilters.push({dimension:b,range_from:null,range_to:null});else for(var d=0;d<a.params.rangefilters.length;d++)if(a.params.rangefilters[d].dimension.split(":")[0]==b){a.params.rangefilters.splice(d,1);break}}else a.params.rangefilters=[];a.cubesviewer.views.redrawView(a)},this.rangefilterValue=function(a){var b=a.range_from,c=a.range_to;if(null!=b||null!=c){var d="";return null!=b&&(d+=b),d+="-",null!=c&&(d+=c),d}return null},this.buildQueryCuts=function(a){var b=cubesviewer.views.cube.rangefilter._overridedbuildQueryCuts(a);return $(a.params.rangefilters).each(function(c,d){var e=a.cubesviewer.views.cube.rangefilter.rangefilterValue(d);null!=e&&b.push(d.dimension+":"+e)}),b}}function cubesviewerViewCubeSeries(){this.cubesviewer=cubesviewer,this.onViewCreate=function(a,b){$.extend(b.params,{xaxis:null,yaxis:null})},this.onViewDraw=function(a,b){null!=b.cube&&($(b.container).find(".cv-view-toolbar").find(".explorebutton").after('<button class="cv-view-button-series" title="Series Table" style="margin-right: 5px;"><span class="ui-icon ui-icon-clock"></span></button>'),$(b.container).find(".cv-view-button-series").button(),$(b.container).find(".cv-view-button-series").click(function(){return b.cubesviewer.views.cube.series.modeSeries(b),!1}),$(b.container).find(".cv-view-button-series").mouseenter(function(){$(".cv-view-menu").hide()}),"series"==b.params.mode&&(b.cubesviewer.views.cube.series.drawInfo(b),$(b.container).find(".cv-view-button-series").button("option","disabled","true").addClass("ui-state-active"),b.cubesviewer.views.cube.series.drawSeriesMenu(b),0==$(b.container).find(".cv-view-viewdata").children().size()&&$(b.container).find(".cv-view-viewdata").empty().append("<h3>Series Table</h3>"),b.cubesviewer.views.cube.series.loadData(b)))},this.drawSeriesMenu=function(a){var b=$(".cv-view-menu-view",$(a.container)),c=(a.cube,cubesviewer.views.cube.explore.getDrillElementsList(a,"cv-view-series-setxaxis",!0)),d="",e=[];
$(a.cube.measures).each(function(b,c){e.push(c.name);var f=$.grep(a.cube.aggregates,function(a){return a.measure==c.name});f.length>0&&(d=d+'<li><a href="#" onclick="return false;">'+c.label+'</a><ul style="width: 220px; z-index: 9999;">',$(f).each(function(a,b){d=d+'<li><a href="#" class="cv-view-series-setyaxis" data-measure="'+b.ref+'">'+b.label+"</a></li>"}),d+="</ul></li>")});var f=$.grep(a.cube.aggregates,function(a){return!a.measure||-1==$.inArray(a.measure,e)});f.length>0&&(d+='<div class="ui-series-measures-sep"></div>',$(f).each(function(a,b){d=d+'<li><a href="#" class="cv-view-series-setyaxis" data-measure="'+b.ref+'">'+b.label+"</a></li>"})),b.append('<li><a href="#" onclick="return false;"><span class="ui-icon ui-icon-arrowthick-1-s"></span>Horizontal Dimension</a><ul style="width: 180px;">'+c+'<div></div><li><a href="#" class="cv-view-series-setxaxis" data-dimension="">None</a></li></ul><li><a href="#" onclick="return false;"><span class="ui-icon ui-icon-zoomin"></span>Measure</a><ul style="min-width: 180px;">'+d+"</ul></li>"),$(b).menu("refresh"),$(b).addClass("ui-menu-icons"),$(a.container).find(".cv-view-series-setyaxis").click(function(){return a.cubesviewer.views.cube.series.selectYAxis(a,$(this).attr("data-measure")),!1}),$(a.container).find(".cv-view-series-setxaxis").click(function(){return a.cubesviewer.views.cube.series.selectXAxis(a,$(this).attr("data-dimension")),!1})},this.modeSeries=function(a){a.params.mode="series",a.cubesviewer.views.redrawView(a)},this.selectYAxis=function(a,b){a.params.yaxis=b,a.cubesviewer.views.redrawView(a)},this.selectXAxis=function(a,b){a.params.xaxis=""==b?null:b,a.cubesviewer.views.redrawView(a)},this.loadData=function(a){if(null==a.params.yaxis)return void $(a.container).find(".cv-view-viewdata").empty().append("<h3>Series Table</h3><div><i>Cannot present series table: no <b>measure</b> has been selected.</i></div>");a.cubesviewer.views.blockViewLoading(a);var b=this.cubesviewer.views.cube.buildBrowserArgs(a,null!=a.params.xaxis?!0:!1,!1),c=new cubes.Browser(a.cubesviewer.cubesserver,a.cube),d=c.aggregate(b,a.cubesviewer.views.cube.series._loadDataCallback(a));d.always(function(){a.cubesviewer.views.unblockView(a)})},this._loadDataCallback=function(a){var a=a;return function(b,c){$(a.container).find(".cv-view-viewdata").empty(),a.cubesviewer.views.cube.series.drawTable(a,b)}},this.drawInfo=function(a){cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-extra"),"#ccccff",350,!0,'<span class="ui-icon ui-icon-zoomin"></span> <b>Measure:</b> '+(null!=a.params.yaxis?a.params.yaxis:"<i>None</i>")),null!=a.params.xaxis&&cubesviewer.views.cube.explore.drawInfoPiece($(a.container).find(".cv-view-viewinfo-extra"),"#ccddff",350,!0,'<span class="ui-icon ui-icon-arrowthick-1-s"></span> <b>Horizontal dimension:</b> '+(null!=a.params.xaxis?a.cube.cvdim_parts(a.params.xaxis).label:"<i>None</i>"))},this.drawTable=function(a,b){if($(a.container).find(".cv-view-viewdata").empty(),0==b.cells.length)return void $(a.container).find(".cv-view-viewdata").append("<h3>Series Table</h3><div>Cannot present series table as no rows are returned by the current filtering, horizontal dimension, and drilldown combination.</div>");$(a.container).find(".cv-view-viewdata").append('<h3>Series Table</h3><table id="seriesTable-'+a.id+'"></table><div id="seriesPager-'+a.id+'"></div>');var c=[],d=[],e=[],f=[],g=[];a.cubesviewer.views.cube.explore._sortData(a,b.cells,null!=a.params.xaxis?!0:!1),a.cubesviewer.views.cube.series._addRows(a,f,g,c,e,b),c.forEach(function(b){var c=null;$(a.cube.aggregates).each(function(a,d){return d.name==b?(c=d.label||d.name,!1):void 0}),c||$(a.cube.measures).each(function(a,d){return d.name==b?(c=d.label||ag.name,!1):void 0}),d.push(c||b)}),$("#seriesTable-"+a.id).jqGrid({data:f,datatype:"local",height:"auto",rowNum:cubesviewer.options.pagingOptions[0],rowList:cubesviewer.options.pagingOptions,colNames:d,colModel:e,pager:"#seriesPager-"+a.id,sortname:cubesviewer.views.cube.explore.defineColumnSort(a,["key","desc"])[0],viewrecords:!0,sortorder:cubesviewer.views.cube.explore.defineColumnSort(a,["key","desc"])[1],userDataOnFooter:!0,forceFit:!1,shrinkToFit:!1,width:cubesviewer.options.tableResizeHackMinWidth,beforeSelectRow:function(){return!1},loadComplete:function(){a.cubesviewer.views.cube.explore.onTableLoaded(a)},resizeStop:a.cubesviewer.views.cube.explore._onTableResize(a),onSortCol:a.cubesviewer.views.cube.explore._onTableSort(a)}),this.cubesviewer.views.cube._adjustGridSize()},this._addRows=function(a,b,c,d,e,f){var g=a.params.drilldown.slice(0);null!=a.params.xaxis&&g.splice(0,0,a.params.xaxis);var h=null==a.params.xaxis?0:1;$(f.cells).each(function(c,f){for(var i=[],j=[],k=0;k<g.length;k++){var l=a.cube.cvdim_parts(g[k]),m=l.hierarchy.readCell(f,l.level),n=[],o=[];$(m).each(function(a,b){n.push(b.key),o.push(b.label)}),j.push(o.join(" / "))}var p=null==a.params.xaxis?a.params.yaxis:j[0],q=f[a.params.yaxis],r=null==a.params.xaxis?j.join(" / "):j.slice(1).join(" / "),i=$.grep(b,function(a){return a.key==r});if(i.length>0)i[0][p]=q;else{var s={};s.key=r,s[p]=q;for(var k=h;k<j.length;k++)s["key"+(k-h)]=j[k];b.push(s)}var t=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],u=cubesviewer.views.cube.columnFormatFunction(a,t);if(d.indexOf(p)<0){d.push(p);var v={name:p,index:p,align:"right",sorttype:"number",width:cubesviewer.views.cube.explore.defineColumnWidth(a,p,75),formatter:function(a,b,c){return u(a)}};e.push(v)}}),$(a.params.drilldown).each(function(b,c){d.splice(b,0,a.cube.cvdim_dim(c).label),e.splice(b,0,{name:"key"+b,index:"key"+b,align:"left",width:cubesviewer.views.cube.explore.defineColumnWidth(a,"key"+b,190)})}),c.key0="<b>Summary</b>",0==a.params.drilldown.length&&(b[0].key0=a.params.yaxis,d.splice(0,0,"Measure"),e.splice(0,0,{name:"key0",index:"key0",align:"left",width:cubesviewer.views.cube.explore.defineColumnWidth(a,"key0",190)}))}}function cubesviewerViewCubeChart(){this.cubesviewer=cubesviewer,this.onViewCreate=function(a,b){$.extend(b.params,{charttype:"bars-vertical",chartoptions:{showLegend:!0}})},this.onViewDestroyed=function(a,b){b.cubesviewer.views.cube.chart.cleanupNvd3()},this.exportChart=function(a){cubesviewer.alert("Not implemented")},this.cleanupNvd3=function(){console.debug("WARNING! Cleanup function disabled: review.")},this.onViewDraw=function(a,b){b.cubesviewer.views.cube.chart.cleanupNvd3(),null!=b.cube&&($(b.container).find(".cv-view-toolbar").find(".cv-view-button-series").after('<button class="cv-view-button-chart" title="Chart" style="margin-right: 15px;"><span class="ui-icon ui-icon-image"></span></button>'),$(b.container).find(".cv-view-button-chart").button(),$(b.container).find(".cv-view-button-chart").click(function(){return b.cubesviewer.views.cube.chart.modeChart(b),!1}),$(b.container).find(".cv-view-button-chart").mouseenter(function(){$(".cv-view-menu").hide()}),"chart"==b.params.mode&&(b.cubesviewer.views.cube.chart.drawInfo(b),$(b.container).find(".cv-view-button-chart").button("option","disabled","true").addClass("ui-state-active"),b.cubesviewer.views.cube.chart.drawChartMenu(b),0==$(b.container).find(".cv-view-viewdata").children().size()&&$(b.container).find(".cv-view-viewdata").append("<h3>Series Chart</h3>"),b.cubesviewer.views.cube.chart.loadData(b)))},this.drawChartMenu=function(a){this.cubesviewer.views.cube.series.drawSeriesMenu(a);var b=$(".cv-view-menu-view",$(a.container));a.cube;b.prepend('<li><a href="#" onclick="return false;"><span class="ui-icon ui-icon-calculator"></span>Chart Type</a><ul style="width: 180px;"><li><a href="#" class="cv-view-chart-settype" data-charttype="pie">Pie</a></li><li><a href="#" class="cv-view-chart-settype" data-charttype="bars-vertical">Bars Vertical</a></li><li><a href="#" class="cv-view-chart-settype" data-charttype="lines">Lines</a></li><li><a href="#" class="cv-view-chart-settype" data-charttype="lines-stacked">Areas</a></li><li><a href="#" class="cv-view-chart-settype" data-charttype="radar">Radar</a></li></ul></li><div></div>'),b.append('<div></div><li><a href="#" class="cv-view-chart-toggle-legend"><span class="ui-icon ui-icon-script"></span>Toggle Legend</a></li>'),$(b).menu("refresh"),$(b).addClass("ui-menu-icons");a.cubesviewer.views.cube.chart;$(a.container).find(".cv-view-chart-toggle-legend").click(function(){return a.params.chartoptions.showLegend=!a.params.chartoptions.showLegend,a.cubesviewer.views.redrawView(a),!1}),$(a.container).find(".cv-view-chart-export").click(function(){return a.cubesviewer.views.cube.chart.exportChart(a),!1}),$(a.container).find(".cv-view-chart-settype").click(function(){return a.cubesviewer.views.cube.chart.selectChartType(a,$(this).attr("data-charttype")),!1})},this.modeChart=function(a){a.params.mode="chart",a.cubesviewer.views.redrawView(a)},this.selectChartType=function(a,b){a.params.charttype=b,a.cubesviewer.views.redrawView(a)},this.drawInfo=function(a){a.cubesviewer.views.cube.series.drawInfo(a)},this.loadData=function(a){if(null==a.params.yaxis)return void $("#"+a.id).find(".cv-view-viewdata").empty().append("<h3>Series Chart</h3><div><i>Cannot present chart: no <b>measure</b> has been selected.</i></div>");a.cubesviewer.views.blockViewLoading(a);var b=this.cubesviewer.views.cube.buildBrowserArgs(a,null!=a.params.xaxis?!0:!1,!1),c=new cubes.Browser(a.cubesviewer.cubesserver,a.cube),d=c.aggregate(b,a.cubesviewer.views.cube.chart._loadDataCallback(a));d.always(function(){a.cubesviewer.views.unblockView(a)})},this._loadDataCallback=function(a){var a=a;return function(b,c){$(a.container).find(".cv-view-viewdata").empty(),a.cubesviewer.views.cube.chart.drawChart(a,b)}},this.resizeChart=function(a,b){$(a.container).find("#seriesChart-"+a.id).find("svg").height(b),$(a.container).find("#seriesChart-"+a.id).find("svg").resize()},this.drawChart=function(a,b){if($(a.container).find(".cv-view-viewdata").empty(),0==b.cells.length)return void $(a.container).find(".cv-view-viewdata").empty().append("<h3>Series Chart</h3><div>Cannot present chart as no rows are returned by the current filtering, horizontal dimension, and drilldown combination.</div>");$(a.container).find(".cv-view-viewdata").css("width","99%"),$(a.container).find(".cv-view-viewdata").append('<h3>Series Chart</h3><div id="seriesChart-'+a.id+'"  ><div><svg style="height: 400px;" /></div><div style="font-size: 8px; float: right;"><a href="" class="cv-chart-height" data-chart-height="400" >Small</a> <a href="" class="cv-chart-height" data-chart-height="550" >Medium</a> <a href="" class="cv-chart-height" data-chart-height="700" >Tall</a></div></div>'),$(a.container).find(".cv-chart-height").click(function(b){b.preventDefault(),a.cubesviewer.views.cube.chart.resizeChart(a,$(this).attr("data-chart-height"))});var c=[],d=[],e=[],f=[];a.cubesviewer.views.cube.explore._sortData(a,b.cells,null!=a.params.xaxis?!0:!1),a.cubesviewer.views.cube.series._addRows(a,e,f,c,d,b),a.params.drilldown.length>0&&(c.splice(0,a.params.drilldown.length,"key"),$(e).each(function(b,c){for(var d=[],e=0;e<a.params.drilldown.length;e++)d.push(c["key"+e]);c.key=d.join(" / ")})),"bars-vertical"==a.params.charttype||"bars-vertical-stacked"==a.params.charttype?a.cubesviewer.views.cube.chart.drawChartBarsVertical(a,c,e,f):"lines"==a.params.charttype?a.cubesviewer.views.cube.chart.drawChartLines(a,c,e,f):"pie"==a.params.charttype?a.cubesviewer.views.cube.chart.drawChartPie(a,c,e,f):"lines-stacked"==a.params.charttype?a.cubesviewer.views.cube.chart.drawChartLines(a,c,e,f):"lines-cumulative"==a.params.charttype?a.cubesviewer.views.cube.chart.drawChartLinesCumulative(a,c,e,f):"radar"==a.params.charttype&&a.cubesviewer.views.cube.chart.drawChartRadar(a,c,e,f)},this.drawChartBarsVertical=function(a,b,c,d){var e=$("#seriesChart-"+a.id).find("svg").get(0),f=null!=a.params.xaxis?a.cube.cvdim_parts(a.params.xaxis).label:"None",g=[],h=(c.length,0);$(c).each(function(c,d){serie=[];for(var e=1;e<b.length;e++){var f=d[b[e]];void 0!=f?serie.push({x:b[e],y:f}):serie.push({x:b[e],y:0})}var i={values:serie,key:""!=d.key?d.key:a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(i.disabled=!!a.params["chart-disabledseries"].disabled[i.key]),g.push(i),h++}),g.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0}),chartOptions={delay:1200,groupSpacing:.1};var i=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],j=cubesviewer.views.cube.columnFormatFunction(a,i);nv.addGraph(function(){var b;return b=nv.models.multiBarChart().showLegend(!!a.params.chartoptions.showLegend).margin({left:120}),a.params["chart-barsvertical-stacked"]&&b.stacked(a.params["chart-barsvertical-stacked"]),b.options(chartOptions),b.multibar.hideable(!0),b.xAxis.axisLabel(f).showMaxMin(!0),b.yAxis.tickFormat(function(a,b){return j(a)}),d3.select(e).datum(g).call(b),nv.utils.windowResize(b.update),b.dispatch.on("stateChange",function(b){a.params["chart-barsvertical-stacked"]=b.stacked,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[g[c].key]=b.disabled[c]}),b})},this.drawChartLines=function(a,b,c,d){var e=$("#seriesChart-"+a.id).find("svg").get(0),f=null!=a.params.xaxis?a.cube.cvdim_parts(a.params.xaxis).label:"None",g=[],h=(c.length,0);$(c).each(function(c,d){serie=[];for(var e=1;e<b.length;e++)if(b[e]in d){var f=d[b[e]];serie.push({x:e,y:f})}else serie.push({x:e,y:0});var i={values:serie,key:""!=d.key?d.key:a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(i.disabled=!!a.params["chart-disabledseries"].disabled[i.key]),g.push(i),h++}),g.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var i=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],j=cubesviewer.views.cube.columnFormatFunction(a,i);"lines-stacked"!=a.params.charttype?nv.addGraph(function(){var c=nv.models.lineChart().useInteractiveGuideline(!0).showLegend(!!a.params.chartoptions.showLegend).margin({left:120});return c.xAxis.axisLabel(f).tickFormat(function(a,c){return b[a]}),c.yAxis.tickFormat(function(a,b){return j(a)}),d3.select(e).datum(g).call(c),nv.utils.windowResize(c.update),c.dispatch.on("stateChange",function(b){a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[g[c].key]=b.disabled[c]}),c}):nv.addGraph(function(){var c=nv.models.stackedAreaChart().showLegend(!!a.params.chartoptions.showLegend).margin({left:130}).clipEdge(!0).useInteractiveGuideline(!0);return a.params["chart-stackedarea-style"]&&c.style(a.params["chart-stackedarea-style"]),c.xAxis.axisLabel(f).showMaxMin(!1).tickFormat(function(a,c){return b[a]}),c.yAxis.tickFormat(function(a,b){return j(a)}),d3.select(e).datum(g).call(c),nv.utils.windowResize(c.update),c.dispatch.on("stateChange",function(b){a.params["chart-stackedarea-style"]=b.style,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[g[c].key]=b.disabled[c]}),c})},this.drawChartPie=function(a,b,c,d){var e=$("#seriesChart-"+a.id).find("svg").get(0),f=(null!=a.params.xaxis?a.cube.cvdim_parts(a.params.xaxis).label:"None",[]);if(b.length>2)return $("#"+a.id).find(".cv-view-viewdata").empty(),void $("#"+a.id).find(".cv-view-viewdata").append("<h3>Series Chart</h3><div><i>Cannot present a Pie Chart when more than one column is present.</i></div>");var g=(c.length,0);$(c).each(function(c,d){serie=[];var e=d[b[1]];if(void 0!=e&&e>0){var h={y:e,key:""!=d.key?d.key:b[0]};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(h.disabled=!!a.params["chart-disabledseries"].disabled[h.key]),f.push(h),g++}}),f.sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:0}),xticks=[];for(var h=1;h<b.length;h++)xticks.push([h-1,b[h]]);var i=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],j=cubesviewer.views.cube.columnFormatFunction(a,i);nv.addGraph(function(){var b=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return a.y}).showLegend(!!a.params.chartoptions.showLegend).labelType("percent");return b.valueFormat(function(a,b){return j(a)}),d3.select(e).datum(f).call(b),nv.utils.windowResize(b.update),b.dispatch.on("stateChange",function(b){a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[f[c].key]=b.disabled[c]}),b})},this.drawChartRadar=function(a,b,c,d){var e=$("#seriesChart-"+a.id).get(0);if(b.length<4)return $("#"+a.id).find(".cv-view-viewdata").empty(),void $("#"+a.id).find(".cv-view-viewdata").append("<h3>Series Chart</h3><div><i>Cannot present a Radar Chart when less than 3 data columns are present.</i></div>");var f=[];numRows=c.length,$(c).each(function(c,d){serie=[];for(var e=1;e<b.length;e++){var g=d[b[e]];void 0!=g?serie.push([e-1,g]):serie.push([e-1,0])}f.push({data:serie,label:""!=d.key?d.key:a.params.yaxis})}),f.sort(function(a,b){return a.label<b.label?-1:a.label>b.label?1:0}),xticks=[];for(var g=1;g<b.length;g++)xticks.push([g-1,b[g]]);$(e).height(350),a.flotrDraw=Flotr.draw(e,f,{HtmlText:!a.doExport,shadowSize:2,height:350,radar:{show:!0},mouse:{track:!0,relative:!0},grid:{circular:!0,minorHorizontalLines:!0},legend:{position:"se",backgroundColor:"#D2E8FF"},xaxis:{ticks:xticks},yaxis:{}})}}function cubesviewerViewCubeFacts(){this.cubesviewer=cubesviewer,this.onViewCreate=function(a,b){$.extend(b.params,{})},this.onViewDraw=function(a,b){null!=b.cube&&($(b.container).find(".cv-view-toolbar").find(".explorebutton").css("margin-right","5px").after('<button class="cv-view-button-facts" title="Facts Table" style="margin-right: 10px;"><span class="ui-icon ui-icon-clipboard"></span></button>'),$(b.container).find(".cv-view-button-facts").button(),$(b.container).find(".cv-view-button-facts").click(function(){return b.cubesviewer.views.cube.facts.modeFacts(b),!1}),$(b.container).find(".cv-view-button-facts").mouseenter(function(){$(".cv-view-menu").hide()}),"facts"==b.params.mode&&(b.cubesviewer.views.cube.facts.drawInfo(b),$(b.container).find(".cv-view-button-facts").button("option","disabled","true").addClass("ui-state-active"),b.cubesviewer.views.cube.facts.drawFactsMenu(b),$(b.container).find(".drilldownbutton").button("disable"),0==$(b.container).find(".cv-view-viewdata").children().size()&&$(b.container).find(".cv-view-viewdata").empty().append("<h3>Facts Table</h3>"),b.cubesviewer.views.cube.facts.loadData(b)))},this.drawFactsMenu=function(a){$(".cv-view-menu-view",$(a.container)),a.cube},this.modeFacts=function(a){a.params.mode="facts",a.cubesviewer.views.redrawView(a)},this.loadData=function(a){a.cubesviewer.views.blockViewLoading(a);var b=this.cubesviewer.views.cube.buildBrowserArgs(a,!1,!1),c=new cubes.Browser(a.cubesviewer.cubesserver,a.cube),d=c.facts(b,a.cubesviewer.views.cube.facts._loadDataCallback(a));d.always(function(){a.cubesviewer.views.unblockView(a)})},this._loadDataCallback=function(a){var a=a;return function(b,c){$(a.container).find(".cv-view-viewdata").empty(),a.cubesviewer.views.cube.facts.drawTable(a,b)}},this.drawInfo=function(a){},this.drawTable=function(a,b){if($(a.container).find(".cv-view-viewdata").empty(),0==b.length)return void $(a.container).find(".cv-view-viewdata").append("<h3>Facts Table</h3><div>No facts are returned by the current filtering combination.</div>");$(a.container).find(".cv-view-viewdata").append('<h3>Facts Table</h3><table id="factsTable-'+a.id+'"></table><div id="factsPager-'+a.id+'"></div>');var c=[],d=[],e=[],f=a.cube.dimensions,g=a.cube.measures,h=a.cube.details;c.push("ID"),d.push({name:"id",index:"id",align:"left",width:cubesviewer.views.cube.explore.defineColumnWidth(a,"id",65),sorttype:"number"});for(var i in f)for(var j=f[i],k=0;k<j.levels.length;k++){var l=j.levels[k];c.push(l.label),d.push({name:l.key().ref,index:l.key().ref,align:"left",width:cubesviewer.views.cube.explore.defineColumnWidth(a,l.key().ref,85)})}for(var m in g){var n=g[m];c.push(n.label);var o=cubesviewer.views.cube.columnFormatFunction(a,n),p={name:n.ref,index:n.ref,align:"right",sorttype:"number",width:cubesviewer.views.cube.explore.defineColumnWidth(a,n.ref,75),formatter:function(a,b,c){return o(a)}};d.push(p)}for(var q in h){var r=h[q];c.push(r.name),d.push({name:r.ref,index:r.ref,align:"left",width:cubesviewer.views.cube.explore.defineColumnWidth(a,l.key().ref,85)})}a.cubesviewer.views.cube.facts._addRows(a,e,b),$("#factsTable-"+a.id).jqGrid({data:e,datatype:"local",height:"auto",rowNum:cubesviewer.options.pagingOptions[0],rowList:cubesviewer.options.pagingOptions,colNames:c,colModel:d,pager:"#factsPager-"+a.id,sortname:cubesviewer.views.cube.explore.defineColumnSort(a,["key","desc"])[0],viewrecords:!0,sortorder:cubesviewer.views.cube.explore.defineColumnSort(a,["key","desc"])[1],userDataOnFooter:!0,forceFit:!1,shrinkToFit:!1,width:cubesviewer.options.tableResizeHackMinWidth,beforeSelectRow:function(){return!1},loadComplete:function(){a.cubesviewer.views.cube.explore.onTableLoaded(a)},resizeStop:a.cubesviewer.views.cube.explore._onTableResize(a),onSortCol:a.cubesviewer.views.cube.explore._onTableSort(a)}),this.cubesviewer.views.cube._adjustGridSize()},this._addRows=function(a,b,c){var d=0,e=a.cube.dimensions,f=a.cube.measures,g=a.cube.details;$(c).each(function(a,c){var h=[];for(var i in e)for(var j=e[i],k=0;k<j.levels.length;k++){var l=j.levels[k],m=l.readCell(c);h[l.key().ref]=m.label}for(var n in f){var o=f[n];h[o.ref]=c[o.ref]}for(var p in g){var q=g[p];h[q.ref]=c[q.ref]}h.id=d++,"id"in c&&(h.id=c.id),h.key=h.id,b.push(h)})}}function cubesviewerViewCubeDimensionFilter(){this.cubesviewer=cubesviewer,this.onViewCreate=function(a,b){b.dimensionFilter=null},this.onViewDraw=function(a,b){if(null!=b.cube){b.cube;b.cubesviewer.views.cube.dimensionfilter.drawFilterMenu(b),b.cubesviewer.views.cube.dimensionfilter.addFilterLinksToInfo(b),null!=b.dimensionFilter&&b.cubesviewer.views.cube.dimensionfilter.drawDimensionFilter(b,b.dimensionFilter)}},this.drawFilterMenu=function(a){var b=(a.cube,$(".cv-view-menu-cut",$(a.container))),c=cubesviewer.views.cube.explore.getDrillElementsList(a,"cv-view-show-dimensionfilter",!1);$(".ui-explore-cut-clearsep",b).before('<li><a href="#" onclick="return false;"><span class="ui-icon ui-icon-zoomin"></span>Dimension filter</a><ul class="dimensionFilterList" style="width: 180px;">'+c+"</ul></li>"),$(b).menu("refresh"),$(b).addClass("ui-menu-icons"),$(a.container).find(".cv-view-show-dimensionfilter").click(function(){return cubesviewer.views.cube.dimensionfilter.drawDimensionFilter(a,$(this).attr("data-dimension")),!1})},this.addFilterLinksToInfo=function(a){$(a.container).find(".cv-view-infopiece-cut").each(function(a,b){$(b).find("button").last().before('<button style="display: inline-block;" class="cv-view-infopiece-cut-editcut"><span class="ui-icon ui-icon-zoomin"></span></button></div>')}),$(a.container).find(".cv-view-viewinfo-cut").find("button.cv-view-infopiece-cut-editcut").button().find("span").css("padding","0px"),$(a.container).find(".cv-view-viewinfo-cut").find("button.cv-view-infopiece-cut-editcut").click(function(){var b=$(this).parents(".cv-view-infopiece-cut").first().attr("data-dimension"),c=a.cube.cvdim_parts(b),d=$(this).parents(".cv-view-infopiece-cut").first().attr("data-value").split(";")[0].split(",").length;cubesviewer.views.cube.dimensionfilter.drawDimensionFilter(a,b+":"+c.hierarchy.levels[d-1])}),$(a.container).find(".cv-view-infopiece-drilldown").each(function(a,b){$(b).find("button").last().before('<button style="display: inline-block;" class="cv-view-infopiece-drilldown-editcut"><span class="ui-icon ui-icon-zoomin"></span></button></div>')}),$(a.container).find(".cv-view-viewinfo-drill").find("button.cv-view-infopiece-drilldown-editcut").button().find("span").css("padding","0px"),$(a.container).find(".cv-view-viewinfo-drill").find("button.cv-view-infopiece-drilldown-editcut").click(function(){var b=$(this).parents(".cv-view-infopiece-drilldown").first().attr("data-dimension");cubesviewer.views.cube.dimensionfilter.drawDimensionFilter(a,b)})},this.drawDimensionFilter=function(a,b){var c=a.cube.cvdim_parts(b);$(a.container).find(".cv-view-dimensionfilter").remove(),$(a.container).find(".cv-view-viewinfo").append('<div class="cv-view-dimensionfilter cv-view-info-panel infopiece ui-widget ui-corner-all" style="background-color: #ffcccc;"><h3>Dimension filter: '+c.label+'</h3><div class="cv-view-dimensionfilter-cont"></div></div>'),$(a.container).find(".cv-view-dimensionfilter-cont").append('<div class="filter-option"> Search: <input style="width: 270px;" name="dimensionfilter-list-search" /></div><div class="filter-option"><label>Invert: <input type="checkbox" class="invert-cut" /></label></div><div class="cv-view-dimensionfilter-list" style="max-height: 300px; overflow-x: hidden; overflow-y: auto; max-width: 580px; "><i>Loading...</i></div>'),$(a.container).find("[name=dimensionfilter-list-search]").on("input",function(){a.cubesviewer.views.cube.dimensionfilter.searchDimensionValues(a,$(a.container).find("[name=dimensionfilter-list-search]").val())}),$(a.container).find(".cv-view-dimensionfilter-cont").append('<div style="margin-top: 10px;"><button class="cv-views-dimensionfilter-apply">Apply</button><button class="cv-views-dimensionfilter-cancel">Close</button><div id="cv-views-dimensionfilter-cols-'+a.id+'" class="cv-views-dimensionfilter-cols" style="display: inline-block; margin-left: 15px; margin-right: 15px; padding: 0px;"><input type="radio" name="cv-views-dimensionfilter-col" id="cv-views-dimensionfilter-col1-'+a.id+'" /><label for="cv-views-dimensionfilter-col1-'+a.id+'">1 col</label><input type="radio" name="cv-views-dimensionfilter-col" id="cv-views-dimensionfilter-col2-'+a.id+'" checked="checked" /><label for="cv-views-dimensionfilter-col2-'+a.id+'">2 cols</label></div><button class="cv-views-dimensionfilter-selectall">Select All</button><button style="margin-right: 15px;" class="cv-views-dimensionfilter-selectnone">Select None</button><button class="cv-views-dimensionfilter-drill">Drilldown this</button></div>'),$(a.container).find(".cv-views-dimensionfilter-apply").button().click(function(){a.cubesviewer.views.cube.dimensionfilter.applyFilter(a,b)}),$(a.container).find(".cv-views-dimensionfilter-cancel").button().click(function(){a.dimensionFilter=null,$(a.container).find(".cv-view-dimensionfilter").remove()}),$(a.container).find("#cv-views-dimensionfilter-cols-"+a.id).buttonset(),$(a.container).find("#cv-views-dimensionfilter-col1-"+a.id).click(function(){a.cubesviewer.views.cube.dimensionfilter.drawDimensionValuesCols(a,1)}),$(a.container).find("#cv-views-dimensionfilter-col2-"+a.id).click(function(){a.cubesviewer.views.cube.dimensionfilter.drawDimensionValuesCols(a,2)}),$(a.container).find(".cv-views-dimensionfilter-selectall").button().click(function(){$(a.container).find(".cv-view-dimensionfilter-list").find(":checkbox").filter(":checked").trigger("click"),$(a.container).find(".cv-view-dimensionfilter-list").find(":checkbox:visible").trigger("click")}),$(a.container).find(".cv-views-dimensionfilter-selectnone").button().click(function(){$(a.container).find(".cv-view-dimensionfilter-list").find(":checkbox").filter(":checked").trigger("click")}),$(a.container).find(".cv-views-dimensionfilter-drill").button().click(function(){return cubesviewer.views.cube.explore.selectDrill(a,c.fullDrilldownValue,"1"),!1}),a.cubesviewer.views.cube.dimensionfilter.loadDimensionValues(a,b)},this.loadDimensionValues=function(a,b){a.dimensionFilter=b;var c=a.cube.cvdim_parts(b),d={hierarchy:c.hierarchy.name,depth:c.depth};a.cubesviewer.cubesRequest("/cube/"+a.cube.name+"/members/"+c.dimension.name,d,a.cubesviewer.views.cube.dimensionfilter._loadDimensionValuesCallback(a,b),function(){})},this._loadDimensionValuesCallback=function(a,b){var a=a,b=b;return function(c,d){a.cubesviewer.views.cube.dimensionfilter.drawDimensionValues(a,b,c)}},this.drawDimensionValuesCols=function(a,b){$(a.container).find(".cv-view-dimensionfilter-list").find("input").each(function(a,c){1==b?($(c).parents(".cv-view-dimensionfilter-item").first().css("display","inline-block"),$(c).parents(".cv-view-dimensionfilter-item").first().css("width","98%")):($(c).parents(".cv-view-dimensionfilter-item").first().css("display","inline-block"),$(c).parents(".cv-view-dimensionfilter-item").first().css("width","48%"))});var c=$(a.container).find("[name=dimensionfilter-list-search]").val();a.cubesviewer.views.cube.dimensionfilter.searchDimensionValues(a,c)},this.drawDimensionValues=function(a,b,c){$(a.container).find(".cv-view-dimensionfilter-list").empty();a.cube.cvdim_dim(b);$(c.data).each(function(c,d){var e=a.cube.cvdim_parts(b),f=e.hierarchy.readCell(d,e.level),g=[],h=[];$(f).each(function(a,b){g.push(b.key),h.push(b.label)}),$(a.container).find(".cv-view-dimensionfilter-list").append('<div class="cv-view-dimensionfilter-item"><label><input type="checkbox" style="vertical-align: middle;" value="'+g.join(",")+'" /> '+h.join(" / ")+"</label></div>")}),a.cubesviewer.views.cube.dimensionfilter.updateFromCut(a,b)},this.searchDimensionValues=function(a,b){$(a.container).find(".cv-view-dimensionfilter-list").find("input").each(function(a,c){""==b||$(c).parent().text().toLowerCase().indexOf(b.toLowerCase())>=0?$(c).parents(".cv-view-dimensionfilter-item").first().show():$(c).parents(".cv-view-dimensionfilter-item").first().hide()})},this.updateFromCut=function(a,b){for(var c=a.cube.cvdim_parts(b),d=c.dimension.name+("default"!=c.hierarchy.name?"@"+c.hierarchy.name:""),e=!1,f=[],g=0;g<a.params.cuts.length;g++)if(a.params.cuts[g].dimension==d){e=a.params.cuts[g].invert,f=a.params.cuts[g].value.split(";");break}e&&$(a.container).find(".cv-view-dimensionfilter-cont .invert-cut").attr("checked","checked"),f.length>0&&$(a.container).find(".cv-view-dimensionfilter-list").find("input").each(function(a,b){for(var c=0;c<f.length;c++)$(b).attr("value")==f[c]&&$(b).attr("checked","checked")})},this.applyFilter=function(a,b){var c=a.cube.cvdim_parts(b),d=$(a.container).find(".cv-view-dimensionfilter-list").find("input:checked"),e=[];d.size()<$(a.container).find(".cv-view-dimensionfilter-list").find("input").size()&&$(a.container).find(".cv-view-dimensionfilter-list").find("input:checked").each(function(a,b){e.push($(b).attr("value"))});var f=$(a.container).find(".cv-view-dimensionfilter .invert-cut").is(":checked"),g=c.dimension.name+("default"!=c.hierarchy.name?"@"+c.hierarchy.name:"");cubesviewer.views.cube.explore.selectCut(a,g,e.join(";"),f)}}function cubesviewerViewCubeColumns(){this.cubesviewer=cubesviewer,this.onViewCreate=function(a,b){$.extend(b.params,{columnHide:{},columnWidths:{},columnSort:{}})},this.onViewDraw=function(a,b){if(null!=b.cube){var c=$(".cv-view-menu-view",$(b.container));b.cube;"explore"==b.params.mode?(c.append("<div></div>"),c.append('<li><a href="#" class="cv-view-hide-columns"><span class="ui-icon ui-icon-script"></span>Choose columns</a></li>'),$(c).menu("refresh"),$(c).addClass("ui-menu-icons")):$(b.container).find(".cv-view-columns-chooser").remove(),$(b.container).find(".cv-view-hide-columns").click(function(){return b.cubesviewer.views.cube.columns.showHideColumns(b),!1})}},this.showHideColumns=function(a){$(a.container).find(".cv-view-columns-chooser").remove();$("#summaryTable-"+a.id);$(a.container).find(".cv-view-viewinfo").append('<div class="cv-view-columns-chooser cv-view-info-panel infopiece ui-widget ui-corner-all" style="background-color: #ddddff;"><h3>Column chooser</h3><div class="cv-view-columns-chooser-cols"></div></div>');var b=[];$(a.cube.measures).each(function(c,d){b.push(d.name);var e=$.grep(a.cube.aggregates,function(a){return a.measure==d.name;
});e.length>0&&($(a.container).find(".cv-view-columns-chooser-cols").append('<span style="float: left; min-width: 180px; margin-right: 20px;"><b>'+d.label+"</b>: </span>"),$(e).each(function(b,c){var d=a.cubesviewer.views.cube.columns.isColumnHidden(a,c.ref)?"":'checked="on"';$(a.container).find(".cv-view-columns-chooser-cols").append('<span style="margin-right: 15px;"><label ><input type="checkbox" '+d+' style="vertical-align: middle;" data-col="'+c.ref+'" class="cv-view-columns-chooser-col" /> '+c.label+"</label></span>")}),$(a.container).find(".cv-view-columns-chooser-cols").append("<br/>"))});var c=$.grep(a.cube.aggregates,function(a){return!a.measure||-1==$.inArray(a.measure,b)});c.length>0&&($(a.container).find(".cv-view-columns-chooser-cols").append('<span style="float: left; min-width: 180px; margin-right: 20px;"><b><i>Derived</i></b>: </span>'),$(c).each(function(b,c){var d=a.cubesviewer.views.cube.columns.isColumnHidden(a,c.ref)?"":'checked="on"';$(a.container).find(".cv-view-columns-chooser-cols").append('<span style="margin-right: 15px;"><label ><input type="checkbox" '+d+' style="vertical-align: middle;" data-col="'+c.ref+'" class="cv-view-columns-chooser-col" /> '+c.label+"</label></span>")}),$(a.container).find(".cv-view-columns-chooser-cols").append("<br/>")),$(a.container).find(".cv-view-columns-chooser-cols").find(".cv-view-columns-chooser-col").click(function(){a.cubesviewer.views.cube.columns.toogleColumn(a,$(this).attr("data-col"))}),$(a.container).find(".cv-view-columns-chooser-cols").append('<div style="margin-top: 10px;"><button class="cv-views-columns-chooser-close" style="margin-right: 15px;">Close Column Chooser</button><button class="cv-views-columns-chooser-selectall">Select All</button><button class="cv-views-columns-chooser-selectnone">Select None</button></div>'),$(a.container).find(".cv-views-columns-chooser-close").button().click(function(){$(this).parents(".cv-view-columns-chooser").remove()}),$(a.container).find(".cv-views-columns-chooser-selectall").button().click(function(){$(a.container).find(".cv-view-columns-chooser-cols").find(":checkbox").not(":checked").trigger("click")}),$(a.container).find(".cv-views-columns-chooser-selectnone").button().click(function(){$(a.container).find(".cv-view-columns-chooser-cols").find(":checkbox").filter(":checked").trigger("click")})},this.isColumnHidden=function(a,b){var c=$("#summaryTable-"+a.id),d=$.grep(c.jqGrid("getGridParam","colModel"),function(a){return a.name==b})[0];return d.hidden},this.toogleColumn=function(a,b){var c=$("#summaryTable-"+a.id),d=$.grep(c.jqGrid("getGridParam","colModel"),function(a){return a.name==b})[0];1==d.hidden?c.jqGrid("showCol",b):c.jqGrid("hideCol",b),a.params.columnHide[b]=d.hidden}}function cubesviewerViewCubeExporter(){this.cubesviewer=cubesviewer,this.onViewDraw=function(a,b){b.cubesviewer.views.cube.exporter.drawMenu(b)},this.drawMenu=function(a){if(null!=a.cube){var b=$(".cv-view-menu-view",$(a.container));a.cube;b.append("<div></div>"),("explore"==a.params.mode||"series"==a.params.mode)&&b.append('<li><a href="#" class="cv-view-export-table"><span class="ui-icon ui-icon-script"></span>Export table</a></li>'),b.append('<li><a href="#" class="cv-view-export-facts"><span class="ui-icon ui-icon-script"></span>Export facts</a></li>'),$(b).menu("refresh"),$(b).addClass("ui-menu-icons"),$(a.container).find(".cv-view-export-table").click(function(){return a.cubesviewer.views.cube.exporter.exportCsv(a),!1}),$(a.container).find(".cv-view-export-facts").click(function(){return a.cubesviewer.views.cube.exporter.exportFacts(a),!1})}},this.exportFacts=function(a){var b=a.cubesviewer.views.cube.buildBrowserArgs(a,!1,!0),c={};c.format="csv",b.cut&&(c.cut=b.cut.toString()),b.order&&(c.order=b.order.toString());var d=a.cubesviewer.options.cubesUrl+"/cube/"+a.cube.name+"/facts?"+$.param(c);window.open(d,"_blank"),window.focus()},this.exportCsv=function(a){var b="";if("explore"==a.params.mode)var c=$("#summaryTable-"+a.id);else var c=$("#seriesTable-"+a.id);for(var d=[],e="explore"==a.params.mode?1:0;e<c.jqGrid("getGridParam","colNames").length;e++)d.push('"'+c.jqGrid("getGridParam","colNames")[e]+'"');b=b+d.join(",")+"\n";for(var f=c.jqGrid("getGridParam","data"),e=0;e<f.length;e++){var g=f[e];d=[];for(var h="explore"==a.params.mode?1:0;h<c.jqGrid("getGridParam","colModel").length;h++){var i=c.jqGrid("getGridParam","colModel")[h].name,j=g[i];j=$("<div>"+j+"</div>").text(),void 0==j&&(j=0),d.push('"'+j+'"')}b=b+d.join(",")+"\n"}var k="data:text/csv;charset=utf-8,"+encodeURIComponent(b);window.open(k,"_blank")}}function cubesviewerViewsUndo(){this.cubesviewer=cubesviewer,this.maxUndo=32,this.onViewCreate=function(a,b){$.extend(b.params,{}),b.undoList=[],b.undoPos=-1},this.onViewDraw=function(a,b){null!=b.cube&&($(b.container).find(".cv-view-toolbar").before('<div style="margin-right: 15px; display: inline-block;"><button class="cv-view-undo cv-view-button-undo" title="Undo" style="margin-right: 5px;"><span class="ui-icon ui-icon-arrowreturnthick-1-w"></span></button><button class="cv-view-redo cv-view-button-redo" title="Redo" style=""><span class="ui-icon ui-icon-arrowreturnthick-1-e"></span></button></div>'),b.cubesviewer.views.undo.drawUndoMenu(b),$(b.container).find(".cv-view-button-undo").button(),$(b.container).find(".cv-view-undo").click(function(){return b.cubesviewer.views.undo.undo(b),!1}),$(b.container).find(".cv-view-button-redo").button(),$(b.container).find(".cv-view-redo").click(function(){return b.cubesviewer.views.undo.redo(b),!1}),b.cubesviewer.views.undo._processDrawState(b),b.undoPos<=0&&($(b.container).find(".cv-view-button-undo").button("option","disabled","true"),$(b.container).find(".cv-view-undo").addClass("disabled")),b.undoPos>=b.undoList.length-1&&($(b.container).find(".cv-view-button-redo").button("option","disabled","true"),$(b.container).find(".cv-view-redo").addClass("disabled")))},this.drawUndoMenu=function(a){$(".cv-view-menu-view",$(a.container)),a.cube},this._processDrawState=function(a){var b=a.cubesviewer.views.serialize(a),c=this.getCurrentUndoState(a);b!=c&&this.pushUndo(a,b)},this.pushUndo=function(a,b){a.undoPos=a.undoPos+1,a.undoPos+1<=a.undoList.length&&a.undoList.splice(a.undoPos,a.undoList.length-a.undoPos),a.undoList.push(b),a.undoList.length>this.maxUndo&&(a.undoList.splice(0,a.undoList.length-this.maxUndo),a.undoPos=a.undoList.length-1)},this.getCurrentUndoState=function(a){return 0==a.undoList.length?"{}":a.undoList[a.undoPos]},this.undo=function(a){a.undoPos=a.undoPos-1,a.undoPos<0&&(a.undoPos=0),this.applyCurrentUndoState(a)},this.redo=function(a){a.undoPos=a.undoPos+1,this.applyCurrentUndoState(a)},this.applyCurrentUndoState=function(a){var b=this.getCurrentUndoState(a);a.params=$.parseJSON(b),a.cubesviewer.views.redrawView(a)}}function cubesviewerGui(){this.cubesviewer=cubesviewer,this.options={container:null,user:null,showAbout:!0},this.views=[],this.lastViewId=0,this._sorting=!1,this.onRefresh=function(){cubesviewer.gui.drawCubesList()},this.closeView=function(a){for(var b=0;b<this.views.length&&this.views[b].id!=a.id;b++);$("#"+a.id).remove(),this.views.splice(b,1),cubesviewer.views.destroyView(a)},this.addViewCube=function(a){this.lastViewId++;var b="view"+this.lastViewId,c=this.createContainer(b),d=cubesviewer.cubesserver.cubeinfo(a),e=this.cubesviewer.views.createView(b,$(".cv-gui-viewcontent",c),"cube",{cubename:a,name:"Cube "+d.label});return this.views.push(e),$(c).find(".cv-gui-closeview").click(function(){return cubesviewer.gui.closeView(e),!1}),e},this.addViewObject=function(a){this.lastViewId++;var b="view"+this.lastViewId,c=this.createContainer(b),d=this.cubesviewer.views.createView(b,$(".cv-gui-viewcontent",c),"cube",a);return this.views.push(d),$(c).find(".cv-gui-closeview").click(function(){return cubesviewer.gui.closeView(d),!1}),d},this.createContainer=function(a){new Ractive({el:$(cubesviewer.gui.options.container).children(".cv-gui-workspace")[0],append:!0,template:cvtemplates.gui_container,partials:cvtemplates,data:{cv:cubesviewer,viewId:a}});return $("#"+a)},this.onViewDraw=function(a,b){var c=$(b.container).parents(".cv-gui-cubesview");$(".cv-gui-container-name",c).empty().text(b.params.name),b.cubesviewer.gui.drawMenu(b)},this.drawMenu=function(a){$(a.container).find(".cv-view-toolbar").append('<button class="panelbutton" title="Panel">Panel</button>'),$(a.container).find(".cv-view-viewmenu").append('<ul class="cv-view-menu cv-view-menu-panel" style="float: right; width: 180px;"></ul>'),$(a.container).find(".panelbutton").button();var b=$(".cv-view-menu-panel",$(a.container));b.append('<li><a class="cv-gui-cloneview" href="#"><span class="ui-icon ui-icon-copy"></span>Clone</a></li><li><a class="cv-gui-renameview" href="#"><span class="ui-icon ui-icon-pencil"></span>Rename...</a></li><div></div><li><a class="cv-gui-closeview" href="#"><span class="ui-icon ui-icon-close"></span>Close</a></li>'),a.cubesviewer.views.cube._initMenu(a,".panelbutton",".cv-view-menu-panel"),$(a.container).find(".cv-gui-closeview").unbind("click").click(function(){return cubesviewer.gui.closeView(a),!1}),$(a.container).find(".cv-gui-renameview").unbind("click").click(function(){return cubesviewer.gui.renameView(a),!1}),$("#"+a.id).find(".cv-gui-container-name").unbind("dblclick").dblclick(function(){return cubesviewer.gui.renameView(a),!1}),$(a.container).find(".cv-gui-cloneview").unbind("click").click(function(){return cubesviewer.gui.cloneView(a),!1})},this.renameView=function(a){var b=prompt("Enter new view name:",a.params.name);null!=b&&""!=b&&(a.params.name=b,cubesviewer.views.redrawView(a))},this.cloneView=function(a){viewobject=$.parseJSON(a.cubesviewer.views.serialize(a)),viewobject.name="Clone of "+viewobject.name;var a=this.addViewObject(viewobject);a.savedId=0,a.owner=this.options.user,a.shared=!1,this.cubesviewer.views.redrawView(a)},this.onCubesViewerInitialized=function(){cubesviewer.gui.drawCubesList()},this.drawCubesList=function(){cubesviewer.gui.menuRactive.reset({cv:cubesviewer}),$(".cv-gui-cubeslist-menu",$(cubesviewer.gui.options.container)).find(".cv-gui-addviewcube").click(function(){cubesviewer.gui.addViewCube($(this).attr("data-cubename"));return!1}),$(cubesviewer.gui.views).each(function(a,b){b.cubesviewer.views.redrawView(b)})},this.onGuiDraw=function(a,b){b.menuRactive=new Ractive({el:$(b.options.container).children(".cv-gui-panel")[0],template:cvtemplates.gui_menu,partials:cvtemplates,data:{cv:cubesviewer}}),$("[data-submenu]",b.options.container).submenupicker(),$(b.options.container).children(".cv-gui-workspace").sortable({placeholder:"ui-state-highlight",distance:15,delay:300,handle:".sorthandle",start:function(a,b){cubesviewer.gui._sorting=!0},stop:function(a,b){setTimeout(function(){cubesviewer.gui._sorting=!1},200)}})},this.init=function(a){$.extend(this.options,a),$(document).trigger("cubesviewerGuiDraw",[this])}}function cubesviewerGuiSerializing(){this.cubesviewer=cubesviewer,this.onGuiDraw=function(a,b){$(b.options.container).find(".cv-gui-tools-menu").prepend('<li><a href="#" class="cv-gui-addserialized">Add view from JSON</a></li>'),$(b.options.container).find(".cv-gui-tools-menu").menu("refresh"),$(".cv-gui-addserialized",b.options.container).click(function(){return cubesviewer.gui.serializing.addSerializedView(b),!1})},this.onViewDraw=function(a,b){b.cubesviewer.gui.serializing.drawMenu(b)},this.drawMenu=function(a){var b=$(".cv-view-menu-panel",$(a.container));a.cube;b.find(".cv-gui-renameview").parent().after('<li><a class="cv-gui-serializeview" href="#"><span class="ui-icon ui-icon-rss"></span> Serialize</a></li>'),$(b).menu("refresh"),$(b).addClass("ui-menu-icons"),$(a.container).find(".cv-gui-serializeview").click(function(){return a.cubesviewer.gui.serializing.serializeView(a),!1})},this.serializeView=function(a){var b=a.cubesviewer.views.serialize(a);console.log(b),this.jqueryUiPopup(b)},this.jqueryUiPopup=function(a){$("<p/>",{text:a}).dialog({buttons:[{text:"Close",click:function(){$(this).dialog("close")}}],open:function(){window.getSelection().removeAllRanges();var a=document.createRange();a.selectNode($(this)[0]),window.getSelection().addRange(a)},create:function(){var a=$(this),b="click."+$(a).attr("id");$("div#body").bind(b,function(){$(a).dialog("close"),$(this).unbind(b)})}})},this.addSerializedView=function(a){var b=prompt("Enter serialized view data: ");if(null!=b){var c=cubesviewer.gui.addViewObject(b);this.cubesviewer.views.redrawView(c)}}}cvtemplates={},cvtemplates.gui={},cvtemplates.gui_about='<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">  <div class="modal-dialog" role="document">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-cube"></i> CubesViewer</h4>      </div>      <div class="modal-body">            <p>CubesViewer is a visual, web-based tool application for exploring and analyzing            OLAP databases served by the Cubes OLAP Framework.</p>            <hr />            <p>Version {{ cv.version }}</p>            <p><a href="https://github.com/jjmontesl/cubesviewer/" target="_blank">https://github.com/jjmontesl/cubesviewer/</a></p>            <p>by José Juan Montes and others (see AUTHORS)</p>            <p>2012 - 2016</p>      </div>      <div class="modal-footer">        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>      </div>    </div>  </div></div>',cvtemplates.gui_container='<div id="{{viewId}}" class="cv-view-panel cv-gui-viewcontainer">    <div class="panel panel-primary">        <div class="panel-heading" style="ver">            Test {{name}}            <button type="button" class="btn btn-primary btn-xs pull-right" style="margin-left: 10px;"><i class="fa fa-fw fa-close"></i></button>            <button type="button" class="btn btn-primary btn-xs pull-right" style="margin-left: 10px;"><i class="fa fa-fw fa-caret-up"></i></button>            <span class="label label-info pull-right cv-gui-container-state">Test2</span>        </div>        <div class="panel-body">            <div class="cv-gui-viewcontent" style="overflow: hidden;"></div>        </div>    </div></div>',cvtemplates.gui_menu='<div class="cv-view-panel">    <div class="dropdown m-b" style="display: inline-block;">      <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>        <i class="fa fa-cube"></i> Cubes <span class="caret"></span>      </button>      <ul class="dropdown-menu cv-gui-cubeslist-menu">        {{#cv.cubesserver._cube_list}}        <li class="cv-gui-addviewcube" data-cubename="{{name}}"><a>{{label}}</a></li>        {{/cv.cubesserver._cube_list}}      </ul>    </div>    <div class="dropdown m-b" style="display: inline-block;">      <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>        <i class="fa fa-wrench"></i> Tools <span class="caret"></span>      </button>      <ul class="dropdown-menu">      <li class="dropdown-submenu">      <a tabindex="0">Action</a>      <ul class="dropdown-menu">        <li><a tabindex="0">Sub action</a></li>        <li class="dropdown-submenu">          <a tabindex="0">Another sub action</a>          <ul class="dropdown-menu">            <li><a tabindex="0">Sub action</a></li>            <li><a tabindex="0">Another sub action</a></li>            <li><a tabindex="0">Something else here</a></li>          </ul>        </li>        <li><a tabindex="0">Something else here</a></li>        <li class="disabled"><a tabindex="-1">Disabled action</a></li>        <li class="dropdown-submenu">          <a tabindex="0">Another action</a>          <ul class="dropdown-menu">            <li><a tabindex="0">Sub action</a></li>            <li><a tabindex="0">Another sub action</a></li>            <li><a tabindex="0">Something else here</a></li>          </ul>        </li>      </ul>    </li>    <li class="dropdown-header">Dropdown header</li>    <li class="dropdown-submenu">      <a tabindex="0">Another action</a>      <ul class="dropdown-menu">        <li><a tabindex="0">Sub action</a></li>        <li><a tabindex="0">Another sub action</a></li>        <li><a tabindex="0">Something else here</a></li>      </ul>    </li>    <li><a tabindex="0">Something else here</a></li>    {{#cv.gui.options.showAbout}}    <div class="divider"></div>    <li class=""><a data-toggle="modal" data-target="#aboutModal">About CubesViewer</a></li>    {{/cv.gui.options.showAbout}}    </ul>    </div>    {{>gui_about}}</div>',function(){var a={};a.map=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d]));return c},a.filter=function(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c},a.find=function(a,b){var c;if("[object Array]"===Object.prototype.toString.call(a)){for(c=0;c<a.length;c++)if(b(a[c]))return a[c]}else for(c in a)if(b(a[c]))return a[c];return null},a.indexOf=function(a,b){var c;if("[object Array]"===Object.prototype.toString.call(a)){for(c=0;c<a.length;c++)if(b(a[c]))return c}else for(c in a)if(b(a[c]))return c;return-1},a.isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},a.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)};var b=this,c={};c.Server=function(a){a?this.ajaxRequest=a:this.ajaxRequest=$.ajax,this._cube_list=[],this._cubes={}},c.Server.prototype.cubeinfo=function(a){if(cubeinfos=$.grep(this._cube_list,function(b){return b.name==a}),1!=cubeinfos.length)throw"Found "+cubeinfos.length+" cubes with name '"+a+"' in the cube list";return cubeinfos[0]},c.Server.prototype.ajaxRequest=function(a){throw"Must implement ajaxRequest for server to process jquery-style $.ajax settings object"},c.Server.prototype.query=function(a,b,c,d,e,f){var g={dataType:"json",type:"GET"};return b.hasOwnProperty("name")?cube_name=b.name:cube_name=b,g.url=this.url+"cube/"+cube_name+"/"+a,g.data=c,c&&c.cut&&(g.data.cut=g.data.cut.toString()),c&&c.drilldown&&(g.data.drilldown=g.data.drilldown.toString()),g.success=function(a){d(a)},g.error=function(a){e&&e(a)},g.complete=function(a){f&&f(a)},this.ajaxRequest(g)},c.Server.prototype.connect=function(a,b,c){var d=this;d.url=d._normalize_url(a);var e={dataType:"json",type:"GET"};e.url=d.url+"info",e.success=function(a,e,f){d.server_version=a.cubes_version,d.cubes_version=a.cubes_version,d.api_version=a.api_version,d.info=a,d.load_cube_list(b,c)},e.error=function(a,b,d){c&&c(a)},this.ajaxRequest(e)},c.Server.prototype._normalize_url=function(a){return"/"!=a[a.length-1]?a+"/":a},c.Server.prototype.load_cube_list=function(a,b){var c=this,d={dataType:"json",type:"GET"};return d.url=c.url+"cubes",d.success=function(b,d,e){c._cube_list=b,a&&a(c._cube_list)},d.error=function(a,c,d){b&&b(a)},this.ajaxRequest(d)},c.Server.prototype.get_cube=function(a,b,d){var e=this;if(a in this._cubes&&b)return b(this._cubes[a]),null;var f={dataType:"json",type:"GET"};return f.url=e.url+"cube/"+encodeURI(a)+"/model",f.success=function(d,f,g){var h=new c.Cube(d);e._cubes[a]=h,b&&b(h)},f.error=function(a,b,c){d&&d(a)},this.ajaxRequest(f)},c.Cube=function(b){this.name=b.name,!b.label||(this.label=b.label),!b.description||(this.description=b.description),!b.key||(this.key=b.key),!b.info||(this.info=b.info),!b.category||(this.category=b.category),!b.features||(this.features=b.features),this.measures=a.map(b.measures||[],function(a){return new c.Measure(a)}),this.aggregates=a.map(b.aggregates||[],function(a){return new c.MeasureAggregate(a)}),this.details=a.map(b.details||[],function(a){return new c.Attribute(a)}),this.dimensions=a.map(b.dimensions||[],function(a){return new c.Dimension(a)})},c.Cube.prototype.dimension=function(b){return a.isObject(b)?b:a.find(this.dimensions,function(a){return a.name===b})},c.Dimension=function(a){var b,d=this;if(d.name=a.name,!a.label||(d.label=a.label),!a.description||(d.description=a.description),!a.default_hierarchy_name||(d.default_hierarchy_name=a.default_hierarchy_name),!a.info||(d.info=a.info),!a.role||(d.role=a.role),!a.cardinality||(d.cardinality=a.cardinality),!a.nonadditive||(d.nonadditive=a.nonadditive),d.levels=[],a.levels)for(b in a.levels){var e=new c.Level(d.name,a.levels[b]);d.levels.push(e)}if(this.hierarchies={},a.hierarchies)for(b in a.hierarchies){var f=new c.Hierarchy(a.hierarchies[b],this);d.hierarchies[f.name]=f}!d.default_hierarchy_name&&a.hierarchies&&a.hierarchies.length>0&&(d.default_hierarchy_name=a.hierarchies[0].name)},c.Dimension.prototype.hierarchy=function(b){return a.isObject(b)?b:b?this.hierarchies[b]:this.hierarchies[this.default_hierarchy_name]},c.Dimension.prototype.level=function(b){return a.isObject(b)?b:a.find(this.levels,function(a){return a.name==b})},c.Dimension.prototype.toString=function(a){return this.name},c.Dimension.prototype.display_label=function(){return this.label||this.name},c.Dimension.prototype.hierarchy=function(b){return a.isObject(b)?b:null!=b?this.hierarchies[b]:this.hierarchies[this.default_hierarchy_name]},c.Hierarchy=function(a,b){this.parse(a,b)},c.Hierarchy.prototype.parse=function(b,c){var d=this;d.name=b.name,!b.label||(d.label=b.label),!b.description||(d.description=b.description),!b.info||(d.info=b.info);var e=b.levels||[];d.levels=a.map(e,function(a){return c.level(a)})},c.Hierarchy.prototype.toString=function(){return c.HIERARCHY_PREFIX_CHAR+this.name},c.Hierarchy.prototype.display_label=function(){return this.label||this.name},c.Level=function(a,b){this.parse(a,b)},c.Level.prototype.parse=function(a,b){var d,e=this;if(e.dimension_name=a,e.name=b.name,!b.label||(e.label=b.label),!b.description||(e.description=b.description),!b.info||(e.info=b.info),e._key=b.key,e._label_attribute=b.label_attribute,e._order_attribute=b.order_attribute,!b.role||(e.role=b.role),!b.cardinality||(e.cardinality=b.cardinality),e.nonadditive=b.nonadditive,e.attributes=[],b.attributes)for(d in b.attributes){var f=new c.Attribute(b.attributes[d]);e.attributes.push(f)}},c.Level.prototype.key=function(){var b=this._key;return the_attr=a.find(this.attributes,function(a){return a.name===b}),the_attr||this.attributes[0]},c.Level.prototype.label_attribute=function(){var b=null;if(this._label_attribute){var c=this._label_attribute;b=a.find(this.attributes,function(a){return a.name===c})}return b||this.key()},c.Level.prototype.order_attribute=function(){var b=null;return this._order_attribute&&(b=a.find(this.attributes,function(a){a.name===this.__order_attribute})),b||this.key()},c.Level.prototype.toString=function(){return this.name},c.Level.prototype.display_name=function(){return this.label||this.name},c.Level.prototype.full_name=function(){return this.dimension_name+c.ATTRIBUTE_STRING_SEPARATOR_CHAR+this.name},c.Level.prototype.full_name_for_drilldown=function(){return this.dimension_name+c.DIMENSION_STRING_SEPARATOR_CHAR+this.name},c.Attribute=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.locales=a.locales},c.Measure=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.nonadditive=a.nonadditive,a.aggregates&&(this.aggregates=a.aggregates)},c.MeasureAggregate=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.locales=a.locales,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.nonadditive=a.nonadditive,this["function"]=a["function"],this.measure=a.measure},c.Browser=function(a,b){this.cube=b,this.server=a},c.Browser.prototype.full_cube=function(){return new c.Cell(this.cube)},c.Browser.prototype.aggregate=function(a,b){a||(a={});var c={};return a.cut&&(c.cut=a.cut.toString()),a.measure&&(c.measure=a.measure.toString()),a.drilldown&&(c.drilldown=a.drilldown.toString()),a.split&&(c.split=a.split.toString()),a.order&&(c.order=a.order.toString()),a.page&&(c.page=a.page),a.pagesize&&(c.pagesize=a.pagesize),this.server.query("aggregate",this.cube,a,b)},c.Browser.prototype.facts=function(a,b){a||(a={});var c={};return a.cut&&(c.cut=a.cut.toString()),a.order&&(c.order=a.order.toString()),a.page&&(c.page=a.page),a.pagesize&&(c.pagesize=a.pagesize),this.server.query("facts",this.cube,a,b)},c.Drilldown=function(b,c,d){if(!a.isObject(b))throw"Drilldown requires a Dimension object as first argument";if(this.dimension=b,this.hierarchy=b.hierarchy(c),this.level=b.level(d)||this.hierarchy.levels[0],!this.hierarchy)throw"Drilldown cannot recognize hierarchy "+c+" for dimension "+b;if(!this.level)throw"Drilldown cannot recognize level "+d+" for dimension "+b},c.Drilldown.prototype.toString=function(){return""+this.dimension+this.hierarchy+c.DIMENSION_STRING_SEPARATOR_CHAR+this.level},c.Drilldown.prototype.keysInResultCell=function(){var b=this,c=!1,d=a.filter(b.hierarchy.levels,function(a){return a.key()===b.level.key()&&(c=!0)||!c});return a.map(d,function(a){return a.key().ref})},c.Drilldown.prototype.labelsInResultCell=function(){var b=this,c=!1,d=a.filter(b.hierarchy.levels,function(a){return a.key()===b.level.key()&&(c=!0)||!c});return a.map(d,function(a){return a.label_attribute().ref})},c.Cell=function(b,c){this.cube=b,this.cuts=a.map(c||[],function(a){return a})},c.Cell.prototype.slice=function(a){for(var b=[],d=!1,e=0;e<this.cuts.length;e++){var f=this.cuts[e];f.dimension==a.dimension?(b.push(a),d=!0):b.push(f)}d||b.push(a);var g=new c.Cell(this.cube,b);return g},c.Cell.prototype.toString=function(){return a.map(this.cuts||[],function(a){return a.toString()}).join(c.CUT_STRING_SEPARATOR_CHAR)},c.Cell.prototype.cut_for_dimension=function(b){return a.find(this.cuts,function(a){return a.dimension.name==b})},c.PointCut=function(a,b,c,d){this.type="point",this.dimension=a,this.hierarchy=a.hierarchy(b),this.path=c,this.invert=!!d},c.PointCut.prototype.toString=function(){var a=c.string_from_path(this.path);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+a},c.SetCut=function(a,b,c,d){this.type="set",this.dimension=a,this.hierarchy=a.hierarchy(b),this.paths=c,this.invert=!!d},c.SetCut.prototype.toString=function(){var b=a.map(this.paths,c.string_from_path).join(c.SET_CUT_SEPARATOR_CHAR);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+b},c.RangeCut=function(a,b,c,d,e){if(this.type="range",this.dimension=a,this.hierarchy=a.hierarchy(b),null===c&&null===d)throw"Either from_path or to_path must be defined for RangeCut";this.from_path=c,this.to_path=d,this.invert=!!e},c.RangeCut.prototype.toString=function(){var a=c.string_from_path(this.from_path)+c.RANGE_CUT_SEPARATOR_CHAR+c.string_from_path(this.to_path);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+a},c.CUT_INVERSION_CHAR="!",c.CUT_STRING_SEPARATOR_CHAR="|",c.DIMENSION_STRING_SEPARATOR_CHAR=":",c.ATTRIBUTE_STRING_SEPARATOR_CHAR=".",c.HIERARCHY_PREFIX_CHAR="@",c.PATH_STRING_SEPARATOR_CHAR=",",c.RANGE_CUT_SEPARATOR_CHAR="-",c.SET_CUT_SEPARATOR_CHAR=";",c.CUT_STRING_SEPARATOR=/\|/g,c.DIMENSION_STRING_SEPARATOR=/:/g,c.PATH_STRING_SEPARATOR=/,/g,c.RANGE_CUT_SEPARATOR=/-/g,c.SET_CUT_SEPARATOR=/;/g,c.PATH_PART_ESCAPE_PATTERN=/([\\!|:;,-])/g,c.PATH_PART_UNESCAPE_PATTERN=/\\([\\!|:;,-])/g,c.CUT_PARSE_REGEXP=new RegExp("^("+c.CUT_INVERSION_CHAR+"?)(\\w+)(?:"+c.HIERARCHY_PREFIX_CHAR+"(\\w+))?"+c.DIMENSION_STRING_SEPARATOR_CHAR+"(.*)$"),c.DRILLDOWN_PARSE_REGEXP=new RegExp("^(\\w+)(?:"+c.HIERARCHY_PREFIX_CHAR+"(\\w+))?(?:"+c.DIMENSION_STRING_SEPARATOR_CHAR+"(\\w+))?$"),c.NULL_PART_STRING="__null__",c.SPLIT_DIMENSION_STRING="__within_split__",c.SPLIT_DIMENSION=new c.Dimension({name:c.SPLIT_DIMENSION_STRING,label:"Matches Filters",hierarchies:[{name:"default",levels:[c.SPLIT_DIMENSION_STRING]}],levels:[{name:c.SPLIT_DIMENSION_STRING,attributes:[{name:c.SPLIT_DIMENSION_STRING}],label:"Matches Filters"}]}),c._split_with_negative_lookbehind=function(a,b,c){for(var d,e=a,f=[];null!=(d=b.exec(e));)e.substr(d.index-c.length,c.length)!=c&&(f.push(e.substring(0,d.index)),e=e.substring(Math.min(d.index+d[0].length,e.length)),b.lastIndex=0);return f.push(e),f},c._escape_path_part=function(a){return null==a?c.NULL_PART_STRING:a.toString().replace(c.PATH_PART_ESCAPE_PATTERN,function(a,b){return"\\"+b})},c._unescape_path_part=function(a){return a===c.NULL_PART_STRING?null:a.replace(c.PATH_PART_UNESCAPE_PATTERN,function(a,b){return b})},c.string_from_path=function(b){var d=a.map(b||[],function(a){return c._escape_path_part(a)}).join(c.PATH_STRING_SEPARATOR_CHAR);return d},c.path_from_string=function(b){var d=c._split_with_negative_lookbehind(b,c.PATH_STRING_SEPARATOR,"\\"),e=a.map(d||[],function(a){return c._unescape_path_part(a)});return e},c.cut_from_string=function(b,d){var e=c.CUT_PARSE_REGEXP.exec(d);if(!e)return null;var f=!!e[1],g=e[2],h=e[3]||null,i=e[4],j=b.dimension(g),k=c._split_with_negative_lookbehind(i,c.SET_CUT_SEPARATOR,"\\");if(k.length>1)return new c.SetCut(j,h,a.map(k,function(a){return c.path_from_string(a)}),f);if(k=c._split_with_negative_lookbehind(i,c.RANGE_CUT_SEPARATOR,"\\"),2==k.length){var l=k[0]?c.path_from_string(k[0]):null,m=k[1]?c.path_from_string(k[1]):null;return new c.RangeCut(j,h,l,m,f)}return new c.PointCut(j,h,c.path_from_string(i),f)},c.cuts_from_string=function(b,d){var e=c._split_with_negative_lookbehind(d,c.CUT_STRING_SEPARATOR,"\\");return a.map(e||[],function(a){return c.cut_from_string(b,a)})},c.cell_from_string=function(a,b){return new c.Cell(a,c.cuts_from_string(a,b))},c.drilldown_from_string=function(a,b){var d=c.DRILLDOWN_PARSE_REGEXP.exec(b);if(!d)return null;var e=d[1],f=d[2]||null,g=d[3]||null,h=a.dimension(e);if(!h){if(e!==c.SPLIT_DIMENSION_STRING)return null;h=c.SPLIT_DIMENSION}return new c.Drilldown(h,f,g)},c.drilldowns_from_string=function(b,d){var e=c._split_with_negative_lookbehind(d,c.CUT_STRING_SEPARATOR,"\\");return a.map(e||[],function(a){return c.drilldown_from_string(b,a)})},c.drilldowns_to_string=function(b){return a.map(b,function(a){return a.toString()}).join(c.CUT_STRING_SEPARATOR_CHAR)},b.cubes=c}.call(this),cubes.Dimension.prototype.hierarchies_count=function(){var a=0;for(hiename in this.hierarchies)this.hierarchies.hasOwnProperty(hiename)&&a++;return a},cubes.Dimension.prototype.default_hierarchy=function(){return this.hierarchies[this.default_hierarchy_name]},cubes.Cube.prototype.cvdim_dim=function(a){var b=a;return a.indexOf("@")>0?b=a.split("@")[0]:a.indexOf(":")>0&&(b=a.split(":")[0]),this.dimension(b)},cubes.Cube.prototype.cvdim_parts=function(a){var b=this.cvdim_dim(a),c=b.default_hierarchy();if(a.indexOf("@")>0){var d=a.split("@")[1].split(":")[0];c=b.hierarchy(d)}var e=null;if(a.indexOf(":")>0){var f=a.split(":")[1];e=b.level(f)}else e=b.level(c.levels[0]);for(var g=null,h=0;h<c.levels.length;h++)if(e.name==c.levels[h]){g=h+1;break}return{dimension:b,level:e,depth:g,hierarchy:c,label:b.label+("default"!=c.name?" / "+c.label:"")+(c.levels.length>1?": "+e.label:""),labelNoLevel:b.label+("default"!=c.name?" / "+c.label:""),fullDrilldownValue:b.name+("default"!=c.name?"@"+c.name:"")+":"+e.name}},cubes.Level.prototype.readCell=function(a){if(!(this.key().ref in a))return null;var b={};return b.key=a[this.key().ref],b.label=a[this.label_attribute().ref],b.info={},$(this.attributes).each(function(c,d){b.info[d.ref]=a[d.ref]}),b},cubes.Hierarchy.prototype.readCell=function(a,b){for(var c=[],d=0;d<this.levels.length;d++){var e=this.levels[d];if(info=e.readCell(a),null!=info&&c.push(info),void 0!=b&&null!=b&&b.name==e.name)break}return c},cubesviewer=new cubesviewer,cubesviewer.cache={},
cubesviewer._cacheOverridedCubesRequest=cubesviewer.cubesRequest,cubesviewer.cubesRequest=function(a,b,c){cubesviewer._cacheCleanup();var d=a+"?"+$.param(b),e=null;if(d in this.cache){c(this.cache[d].data);var f=Math.round(((new Date).getTime()-this.cache[d].time)/1e3/60);f>cubesviewer.options.cacheNoticeAfterMinutes&&cubesviewer.showInfoMessage("Data loaded from cache<br/>("+f+" minutes old)",1e3),e=$.Deferred().resolve().promise()}else e=cubesviewer._cacheOverridedCubesRequest(a,b,this.cacheCubesRequestSuccess(c,d));return e},cubesviewer._cacheCleanup=function(){var a=30,b=32;"cacheMinutes"in cubesviewer.options&&(a=cubesviewer.options.cacheMinutes),"cacheSize"in cubesviewer.options&&(b=cubesviewer.options.cacheSize);var c=(new Date).getTime()-6e4*a,d=[];for(element in this.cache)this.cache[element].time<c?delete this.cache[element]:d.push(element);if(d.sort(function(a,b){return cubesviewer.cache[a].time-cubesviewer.cache[b].time}),d.length>=b)for(var e=0;e<d.length-b;e++)delete this.cache[d[e]]},cubesviewer.cacheCubesRequestSuccess=function(a,b){return function(c){cubesviewer.cache[b]={time:(new Date).getTime(),data:c},a(c)}},cubesviewer.views=new cubesviewerViews,$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.onViewDraw),Math.formatnumber=function(a,b,c,d){if(void 0===a)return"";void 0===b&&(b=2),void 0===c&&(c="."),void 0===d&&(d=" ");for(var e="",f=Math.floor(a).toString(),g=0;g<f.length;g++){e+=f[g];var h=f.length-g-1;h>0&&h%3==0&&(e+=d)}return b>0&&(e+=parseFloat(a-Math.floor(a)).toFixed(b).toString().replace(".",c).substring(1)),e},cubesviewer.views.cube=new cubesviewerViewCube,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.onViewDraw),$(window).bind("resize",function(){cubesviewer.views.cube._adjustGridSize()}).trigger("resize"),cubesviewer.views.cube.explore=new cubesviewerViewCubeExplore,$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.explore.onViewDraw),cubes.Dimension.prototype.isDateDimension=function(){return!("time"!=this.role||"cv-datefilter"in this.info&&1!=this.info["cv-datefilter"])},cubesviewer.views.cube.datefilter=new cubesviewerViewCubeDateFilter,cubesviewer.views.cube.datefilter._overridedbuildQueryCuts=cubesviewer.views.cube.buildQueryCuts,cubesviewer.views.cube.buildQueryCuts=cubesviewer.views.cube.datefilter.buildQueryCuts,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.datefilter.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.datefilter.onViewDraw),cubes.Dimension.prototype.isRangeDimension=function(){return"cv-rangefilter"in this.info&&1==this.info["cv-rangefilter"]},cubesviewer.views.cube.rangefilter=new cubesviewerViewCubeRangeFilter,cubesviewer.views.cube.rangefilter._overridedbuildQueryCuts=cubesviewer.views.cube.buildQueryCuts,cubesviewer.views.cube.buildQueryCuts=cubesviewer.views.cube.rangefilter.buildQueryCuts,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.rangefilter.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.rangefilter.onViewDraw),cubesviewer.views.cube.series=new cubesviewerViewCubeSeries,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.series.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.series.onViewDraw),cubesviewer.views.cube.chart=new cubesviewerViewCubeChart,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.chart.onViewCreate),$(document).bind("cubesviewerViewDestroyed",{},cubesviewer.views.cube.chart.onViewDestroyed),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.chart.onViewDraw),cubesviewer.views.cube.facts=new cubesviewerViewCubeFacts,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.facts.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.facts.onViewDraw),cubesviewer.views.cube.dimensionfilter=new cubesviewerViewCubeDimensionFilter,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.dimensionfilter.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.dimensionfilter.onViewDraw),cubesviewer.views.cube.explore.onTableResize=function(a,b,c){if(widths={},"explore"==a.params.mode)var d=$("#summaryTable-"+a.id);else if("series"==a.params.mode)var d=$("#seriesTable-"+a.id);else{if("facts"!=a.params.mode)return;var d=$("#factsTable-"+a.id)}for(var e="explore"==a.params.mode?1:0;e<d.jqGrid("getGridParam","colNames").length;e++)widths[d.jqGrid("getGridParam","colModel")[e].name]=d.jqGrid("getGridParam","colModel")[e].width;$.extend(a.params.columnWidths,widths)},cubesviewer.views.cube.explore.onTableSort=function(a,b,c,d){data={},data[a.params.mode]=[b,d],$.extend(a.params.columnSort,data)},cubesviewer.views.cube.explore.defineColumnWidth=function(a,b,c){return b in a.params.columnWidths?a.params.columnWidths[b]:c},cubesviewer.views.cube.explore.defineColumnSort=function(a,b){return a.params.mode in a.params.columnSort?a.params.columnSort[a.params.mode]:b},cubesviewer.views.cube.explore.onTableLoaded=function(a,b,c){if("explore"==a.params.mode)var d=$("#summaryTable-"+a.id);else if("series"==a.params.mode)var d=$("#seriesTable-"+a.id);else{if("facts"!=a.params.mode)return;var d=$("#factsTable-"+a.id)}if("explore"==a.params.mode)for(var e="explore"==a.params.mode?1:0;e<d.jqGrid("getGridParam","colNames").length;e++){var f=d.jqGrid("getGridParam","colModel")[e].name;1==a.params.columnHide[f]&&d.jqGrid("hideCol",f)}},cubesviewer.views.cube.columns=new cubesviewerViewCubeColumns,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.cube.columns.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.columns.onViewDraw),cubesviewer.views.cube.exporter=new cubesviewerViewCubeExporter,$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.cube.exporter.onViewDraw),cubesviewer.views.undo=new cubesviewerViewsUndo,$(document).bind("cubesviewerViewCreate",{},cubesviewer.views.undo.onViewCreate),$(document).bind("cubesviewerViewDraw",{},cubesviewer.views.undo.onViewDraw),cubesviewer.gui=new cubesviewerGui,$(document).bind("cubesviewerRefresh",{gui:cubesviewer.gui},cubesviewer.gui.onRefresh),$(document).bind("cubesviewerGuiDraw",{gui:cubesviewer.gui},cubesviewer.gui.onGuiDraw),$(document).bind("cubesviewerViewDraw",{},cubesviewer.gui.onViewDraw),$(document).bind("cubesviewerInitialized",{},cubesviewer.gui.onCubesViewerInitialized),cubesviewer.gui.serializing=new cubesviewerGuiSerializing,$(document).bind("cubesviewerViewDraw",{},cubesviewer.gui.serializing.onViewDraw),$(document).bind("cubesviewerGuiDraw",{},cubesviewer.gui.serializing.onGuiDraw);